# ENVIRO-LABOR

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE)
#quanteda_options(tokens_block_size = 50000)

options(repos = list(CRAN="http://cran.rstudio.com/"))
install.packages("pacman")
library(pacman)

p_load(bookdown,
       data.table,
       DataTables,
       dplyr, 
       DT,
       forcats,
       ggrepel,
       htmlwidgets,
       lubridate,
       plotly,
       quanteda,
       stopwords,
       tictoc,
       tidyverse, 
       tidytext,
       tokenizers,
       vroom,
       widyr,
       ggraph,
       igraph,
       topicmodels)

```

### DATA
```{r input data, include=FALSE, cache=TRUE, cache.lazy=FALSE}
# #### DATA
# load(verbose=TRUE,"data/enviroLaborSpeeches.Rda")

stopwords_iso <- stopwords("en", source = "stopwords-iso") 
stopwords_manual <- c("absent","adjourn", "ask", "can", "chairman",
                       "committee","con","democrat","etc","gentleladies",
                       "gentlelady", "gentleman", "gentlemen", "gentlewoman",
                       "gentlewomen","hereabout","hereafter","hereat", "hereby",
                       "herein", "hereinafter", "hereinbefore", "hereinto", "hereof",
                       "hereon", "hereto", "heretofore", "hereunder", "hereunto",
                       "hereupon", "herewith", "month", "mr", "mrs", "nai", "nay",
                       "none", "now", "part", "per", "pro", "republican",
                       "say", "senator", "shall", "sir", "speak", "speaker",
                       "tell", "thank", "thereabout", "thereafter", "thereagainst",
                       "thereat", "therebefore", "therebeforn", "thereby", "therefor",
                       "therefore", "therefrom", "therein", "thereinafter", "thereof",
                       "thereon", "thereto", "theretofore", "thereunder", "thereunto",
                       "thereupon", "therewith", "therewithal", "today", "whereabouts",
                       "whereafter", "whereas", "whereat", "whereby","wherefore",
                       "wherefrom", "wherein", "whereinto", "whereof", "whereon","whereto",
                       "whereunder", "whereupon", "wherever", "wherewith", 
                       "wherewithal", "will", "yea", "yes", "yield")

stopwords_manual2 <- c("white house","white houses",
                       "avenue","street","nw","northwest","suite",
                       "number","numeric","sequence","sequences",
                       "add","addition","additions","adding","added",
                       "amend","amended","amendment","amendments","amending","amends",
                       "america","american","americas",
                       "bill","bills",
                       "chapter","chapters",
                       "code","codes",
                       "country","countrys", 
                       "congress","congressional",
                       "district of columbia","district","districts",
                       "enact","enacted","enacting","enacts",
                       "federal", 
                       "senate","senates", 
                       "house of representatives","representative","representatives","the house",
                       "insert","inserting","inserted","inserts",
                       "law","laws",
                       "legislation","legislative","legislator",
                       "paragraph","paragraphs","sentence","sentences",
                       "percent","percentage","percentages",
                       "president","presidents","presidential", 
                       "print","printing","printed","prints",
                       "record","recording","recorded","records",
                       "section","sections",
                       "united states",
                       "state","states",
                       "subchapter","subchapters",
                       "subsection","subsections",
                       "supreme court","supreme courts","court","courts",
                       "title","titles",
                       "unanimous consent","consent","consenting",
                       "united","u.s.","us",
                       "urge","urging","urged","urges",
                       "colleague","colleagues",
                       "washington", "d.c.")

stopwords <- c(stopwords_manual2,stopwords_manual,stopwords_iso)

bad_syntax <- vroom("data/vocabulary/master_list.txt",delim="|") %>%
  rename("classify" = "_classify") %>%
  filter(classify != "vocab") %>%
  mutate(phrase=str_replace_all(phrase," ","_"))

bad_syntax_manual <- c("llc_york",
                       "york_trump",
                       "remain_expend",
                       "corp_york",
                       "dt_mark",
                       "llc_trump",
                       "subparagraph_strike",
                       "unoblig_balanc",
                       "include_transfer",
                       "fiscal_fiscal",
                       "pre_submiss",
                       "preced_divis",
                       "preced_proviso",
                       "corp_trump",
                       "york_dt",
                       "dt_mark",
                       "manag_corp",
                       "hous_dc",
                       "dc_hon")

```

```{r input tokens data, include=FALSE, cache=TRUE, cache.lazy=FALSE}
#### INPUT TOKENS

load(verbose=TRUE,"data/R/enviroLaborTokens.Rda")

load(verbose=TRUE,"data/R/enviroLaborBigrams.Rda")

```

```{r enviroLabor bigrams, message=FALSE, results=FALSE, cache=TRUE, lazy.cache=FALSE, eval=FALSE}

# ##### BIGRAMS #####
tic()
enviroLaborBigrams <- enviroLaborSpeeches %>%
  filter(environment=="Yes" & labor=="Yes") %>%
  corpus(docid_field="speech_id",
         text_field="speech") %>%
  tokenize_word_stems(stopwords=stopwords) %>%
  tokens(remove_punct=FALSE, #CREATE TOKEN OBJECT
         split_tags=TRUE,
         split_elisions=TRUE,
         remove_symbols=TRUE,
         remove_numbers=TRUE,
         remove_separators=TRUE,
         padding=FALSE,
         xptr=TRUE,
         verbose=TRUE) %>%
  tokens_remove("\\p{P}", valuetype = "regex", #REMOVE PUNCT
                padding=TRUE, #REPLACE W/ EMPTY STRINGS
                verbose=TRUE) %>%
  # tokens_remove(stopwords, #REMOVE STOP WORDS BEFORE TRIPLES CREATED
  #               padding=FALSE,
  #               verbose=TRUE) %>%
  tokens_ngrams(n=2) %>% #CREATE BIGRAMS
  dfm() %>% #CREATE DOC-TERM MATRIX
  tidy() %>%
  filter(!(term %in% bad_syntax$phrase)) %>%
  filter(!(term %in% bad_syntax_manual)) %>%
  mutate(speech_id=as.double(document)) %>%
  left_join(enviroLaborSpeeches %>% select(year,date,speech_id,environment,labor),by=join_by(speech_id==speech_id)) %>%
  as_tibble()

toc()
#
# ##### SAVE FILE
save(enviroLaborBigrams,file="data/R/enviroLaborBigrams.Rda")

```

```{r enviroLabor tokens, message=FALSE, results=FALSE, cache=TRUE, lazy.cache=FALSE, eval=FALSE}

##### TOKENS #####
tic()
enviroLaborTokens <- enviroLaborSpeeches %>%
  filter(environment=="Yes" & labor=="Yes") %>%
  corpus(docid_field="speech_id",
         text_field="speech") %>%
  tokenize_word_stems(stopwords=stopwords) %>%
  tokens(remove_punct=TRUE, #CREATE TOKEN OBJECT
         split_tags=TRUE,
         split_elisions=TRUE,
         remove_symbols=TRUE,
         remove_numbers=TRUE,
         remove_separators=TRUE,
         padding=FALSE,
         xptr=TRUE,
         verbose=TRUE) %>%
  dfm() %>% #CREATE DOC-TERM MATRIX
  tidy() %>%
  mutate(speech_id=as.double(document)) %>%
  left_join(enviroLaborSpeeches %>% select(year,date,speech_id,environment,labor),by=join_by(speech_id==speech_id)) %>%
  as_tibble()
toc()

##### SAVE FILE
save(enviroLaborTokens,file="data/R/enviroLaborTokens.Rda")

```


## BIGRAM COUNTS 

##### pre- vs. post-war
```{r top enviroLabor bigrams pre- vs. post-war, message=FALSE, cache=TRUE}

enviroLabor_bigrams_pre_vs_post_war <- enviroLaborBigrams %>%
  filter(!(term %in% bad_syntax$phrase)) %>%
  mutate(period = case_when(year >= 1875 & year <= 1945 ~ "1875-1945",
                            year > 1945 ~ "1946-present")) %>%
  group_by(period) %>%
  count(term,wt=count) %>%
  top_n(35) %>%
  arrange(desc(n))
save(enviroLabor_bigrams_pre_vs_post_war,file="data/R/tables/enviroLaborBigrams_pre_vs_post_war.Rda")


#### pre-war
top_enviroLabor_bigrams_pre_war <- ggplot() +
  geom_col(data=filter(enviroLabor_bigrams_pre_vs_post_war,period=="1875-1945"),
           aes(x=reorder_within(term,n,period),y=n),
               fill="blueviolet") +
  coord_flip() +
  scale_x_reordered() +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(title="1875-1945",x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLabor_bigrams_pre_war, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("congress_bookdown/figures/top_enviroLabor_bigrams_pre_war.html",selfcontained = F, libdir = "lib")


#### post-war
top_enviroLabor_bigrams_post_war <- ggplot() +
  geom_col(data=filter(enviroLabor_bigrams_pre_vs_post_war,period=="1946-present"),
           aes(x=reorder_within(term,n,period),y=n),
               fill="blueviolet") +
  coord_flip() +
  scale_x_reordered() +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(title="1946-present",x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLabor_bigrams_post_war, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("congress_bookdown/figures/top_enviroLabor_bigrams_post_war.html",selfcontained = F, libdir = "lib")

```

##### 25-year period 
```{r top enviroLabor bigrams by year 25-yr period, message=FALSE, cache=TRUE}

enviroLabor_bigrams_by_year_25yr <- enviroLaborBigrams %>%
  filter(!(term %in% bad_syntax$phrase)) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 25) %>%
  group_by(period) %>%
  count(term,wt=count) %>%
  top_n(25) %>%
  arrange(desc(n))
save(enviroLabor_bigrams_by_year_25yr,file="data/R/tables/enviroLaborBigrams_by_25yrs.Rda")


#### 1875 & 1900
top_enviroLaborBigrams_25yr_1875_1900 <- ggplot() +
  geom_col(data=filter(enviroLabor_bigrams_by_year_25yr,period==1875 | period==1900),
           aes(x=reorder_within(term,n,period),
               y=n,
               text=paste("<b>",term,":</b> ",n,sep="")),
               fill="blueviolet") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_25yr_1875_1900, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("congress_bookdown/figures/top_enviroLaborBigrams_25yr_1875_1900.html",selfcontained = F, libdir = "lib")


#### 1925 & 1950
top_enviroLaborBigrams_25yr_1925_1950 <- ggplot() +
  geom_col(data=filter(enviroLabor_bigrams_by_year_25yr,period==1925 | period==1950),
           aes(x=reorder_within(term,n,period),
               y=n,
               text=paste("<b>",term,":</b> ",n,sep="")),
               fill="blueviolet") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_25yr_1925_1950, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("congress_bookdown/figures/top_enviroLaborBigrams_25yr_1925_1950.html",selfcontained = F, libdir = "lib")


#### 1975 & 2000
top_enviroLaborBigrams_25yr_1975_2000 <- ggplot() +
  geom_col(data=filter(enviroLabor_bigrams_by_year_25yr,period==1975 | period==2000),
           aes(x=reorder_within(term,n,period),
               y=n,
               text=paste("<b>",term,":</b> ",n,sep="")),
               fill="blueviolet") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_25yr_1975_2000, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("congress_bookdown/figures/top_enviroLaborBigrams_25yr_1975_2000.html",selfcontained = F, libdir = "lib")

```

##### 20-year period 
```{r top enviroLabor bigrams by year 20-yr period, message=FALSE, cache=TRUE}

enviroLabor_bigrams_by_year_20yr <- enviroLaborBigrams %>%
  filter(year>=1900 & year<=2019) %>%
  filter(!(term %in% bad_syntax$phrase)) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 20) %>%
  group_by(period) %>%
  count(term,wt=count) %>%
  top_n(25) %>%
  arrange(desc(n))
save(enviroLabor_bigrams_by_year_20yr,file="data/R/tables/enviroLaborBigrams_by_20yrs.Rda")


#### 1900 & 1920
top_enviroLaborBigrams_20yr_1900_1920 <- ggplot() +
  geom_col(data=filter(enviroLabor_bigrams_by_year_20yr,period==1900 | period==1920),
           aes(x=reorder_within(term,n,period),
               y=n,
               text=paste("<b>",term,":</b> ",n,sep="")),
               fill="blueviolet") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_20yr_1900_1920, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("congress_bookdown/figures/top_enviroLaborBigrams_20yr_1900_1920.html",selfcontained = F, libdir = "lib")


#### 1940 & 1960
top_enviroLaborBigrams_20yr_1940_1960 <- ggplot() +
  geom_col(data=filter(enviroLabor_bigrams_by_year_20yr,period==1940 | period==1960),
           aes(x=reorder_within(term,n,period),
               y=n,
               text=paste("<b>",term,":</b> ",n,sep="")),
               fill="blueviolet") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_20yr_1940_1960, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("congress_bookdown/figures/top_enviroLaborBigrams_20yr_1940_1960.html",selfcontained = F, libdir = "lib")


#### 1980 & 2000
top_enviroLaborBigrams_20yr_1980_2000 <- ggplot() +
  geom_col(data=filter(enviroLabor_bigrams_by_year_20yr,period==1980 | period==2000),
           aes(x=reorder_within(term,n,period),
               y=n,
               text=paste("<b>",term,":</b> ",n,sep="")),
               fill="blueviolet") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_20yr_1980_2000, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("congress_bookdown/figures/top_enviroLaborBigrams_20yr_1980_2000.html",selfcontained = F, libdir = "lib")

```

##### 15-year period 
```{r top enviroLabor bigrams by year 15-yr period, message=FALSE, cache=TRUE}

enviroLabor_bigrams_by_year_15yr <- enviroLaborBigrams %>%
  filter(year>=1905) %>%
  filter(!(term %in% bad_syntax$phrase)) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 15) %>%
  group_by(period) %>%
  count(term,wt=count) %>%
  top_n(25) %>%
  arrange(desc(n))
save(enviroLabor_bigrams_by_year_15yr,file="data/R/tables/enviroLaborBigrams_by_15yrs.Rda")
  


#### 1905 & 1920
top_enviroLaborBigrams_15yr_1905_1920 <- ggplot() +
  geom_col(data=filter(enviroLabor_bigrams_by_year_15yr,period==1905 | period==1920),
           aes(x=reorder_within(term,n,period),
               y=n,
               text=paste("<b>",term,":</b> ",n,sep="")),
               fill="blueviolet") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_15yr_1905_1920, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("congress_bookdown/figures/top_enviroLaborBigrams_15yr_1905_1920.html",selfcontained = F, libdir = "lib")



#### 1935 & 1950
top_enviroLaborBigrams_15yr_1935_1950 <- ggplot() +
  geom_col(data=filter(enviroLabor_bigrams_by_year_15yr,period==1935 | period==1950),
           aes(x=reorder_within(term,n,period),
               y=n,
               text=paste("<b>",term,":</b> ",n,sep="")),
               fill="blueviolet") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_15yr_1935_1950, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("congress_bookdown/figures/top_enviroLaborBigrams_15yr_1935_1950.html",selfcontained = F, libdir = "lib")



#### 1965 & 1980
top_enviroLaborBigrams_15yr_1965_1980 <- ggplot() +
  geom_col(data=filter(enviroLabor_bigrams_by_year_15yr,period==1965 | period==1980),
           aes(x=reorder_within(term,n,period),
               y=n,
               text=paste("<b>",term,":</b> ",n,sep="")),
               fill="blueviolet") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_15yr_1965_1980, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("congress_bookdown/figures/top_enviroLaborBigrams_15yr_1965_1980.html",selfcontained = F, libdir = "lib")


#### 1995 & 2010
top_enviroLaborBigrams_15yr_1995_2010 <- ggplot() +
  geom_col(data=filter(enviroLabor_bigrams_by_year_15yr,period==1995 | period==2010),
           aes(x=reorder_within(term,n,period),
               y=n,
               text=paste("<b>",term,":</b> ",n,sep="")),
               fill="blueviolet") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_15yr_1995_2010, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("congress_bookdown/figures/top_enviroLaborBigrams_15yr_1995_2010.html",selfcontained = F, libdir = "lib")

```

##### 10-year period 
```{r top enviroLabor bigrams by year 10-yr period, message=FALSE, cache=TRUE}

enviroLabor_bigrams_by_year_10yr <- enviroLaborBigrams %>%
  filter(year>=1890) %>%
  filter(!(term %in% bad_syntax$phrase)) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 10) %>%
  group_by(period) %>%
  count(term,wt=count) %>%
  top_n(25) %>%
  arrange(desc(n))
save(enviroLabor_bigrams_by_year_10yr,file="data/R/tables/enviroLaborBigrams_by_10yrs.Rda")
  


#### 1890 & 1900
top_enviroLaborBigrams_10yr_1890_1900 <- ggplot() +
  geom_col(data=filter(enviroLabor_bigrams_by_year_10yr,period==1890 | period==1900),
           aes(x=reorder_within(term,n,period),
               y=n,
               text=paste("<b>",term,":</b> ",n,sep="")),
               fill="blueviolet") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_10yr_1890_1900, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("congress_bookdown/figures/top_enviroLaborBigrams_10yr_1890_1900.html",selfcontained = F, libdir = "lib")




#### 1910 & 1920
top_enviroLaborBigrams_10yr_1910_1920 <- ggplot() +
  geom_col(data=filter(enviroLabor_bigrams_by_year_10yr,period==1910 | period==1920),
           aes(x=reorder_within(term,n,period),
               y=n,
               text=paste("<b>",term,":</b> ",n,sep="")),
               fill="blueviolet") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_10yr_1910_1920, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("congress_bookdown/figures/top_enviroLaborBigrams_10yr_1910_1920.html",selfcontained = F, libdir = "lib")



#### 1930 & 1940
top_enviroLaborBigrams_10yr_1930_1940 <- ggplot() +
  geom_col(data=filter(enviroLabor_bigrams_by_year_10yr,period==1930 | period==1940),
           aes(x=reorder_within(term,n,period),
               y=n,
               text=paste("<b>",term,":</b> ",n,sep="")),
               fill="blueviolet") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_10yr_1930_1940, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("congress_bookdown/figures/top_enviroLaborBigrams_10yr_1930_1940.html",selfcontained = F, libdir = "lib")


#### 1950 & 1960
top_enviroLaborBigrams_10yr_1950_1960 <- ggplot() +
  geom_col(data=filter(enviroLabor_bigrams_by_year_10yr,period==1950 | period==1960),
           aes(x=reorder_within(term,n,period),
               y=n,
               text=paste("<b>",term,":</b> ",n,sep="")),
               fill="blueviolet") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_10yr_1950_1960, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("congress_bookdown/figures/top_enviroLaborBigrams_10yr_1950_1960.html",selfcontained = F, libdir = "lib")


#### 1970 & 1980
top_enviroLaborBigrams_10yr_1970_1980 <- ggplot() +
  geom_col(data=filter(enviroLabor_bigrams_by_year_10yr,period==1970 | period==1980),
           aes(x=reorder_within(term,n,period),
               y=n,
               text=paste("<b>",term,":</b> ",n,sep="")),
               fill="blueviolet") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_10yr_1970_1980, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("congress_bookdown/figures/top_enviroLaborBigrams_10yr_1970_1980.html",selfcontained = F, libdir = "lib")

#### 1990 & 2000
top_enviroLaborBigrams_10yr_1990_2000 <- ggplot() +
  geom_col(data=filter(enviroLabor_bigrams_by_year_10yr,period==1990 | period==2000),
           aes(x=reorder_within(term,n,period),
               y=n,
               text=paste("<b>",term,":</b> ",n,sep="")),
               fill="blueviolet") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_10yr_1990_2000, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("congress_bookdown/figures/top_enviroLaborBigrams_10yr_1990_2000.html",selfcontained = F, libdir = "lib")


#### 2010 & 2020
top_enviroLaborBigrams_10yr_2010_2020 <- ggplot() +
  geom_col(data=filter(enviroLabor_bigrams_by_year_10yr,period==2010 | period==2020),
           aes(x=reorder_within(term,n,period),
               y=n,
               text=paste("<b>",term,":</b> ",n,sep="")),
               fill="blueviolet") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_10yr_2010_2020, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("congress_bookdown/figures/top_enviroLaborBigrams_10yr_2010_2020.html",selfcontained = F, libdir = "lib")


```



## TF-IPF

```{r SET-UP enviroLabor tf-ipf}

enviroLaborBigrams_count <- enviroLaborBigrams %>%
  group_by(year,term) %>%
  count(term,wt=count) %>%
  filter(n>15)

# enviroLaborTokens_count <- enviroLaborTokens %>%
#   group_by(year,term) %>%
#   count(term,wt=count) %>%
#   filter(n>15)

```

##### pre vs. post-war
```{r enviroLabor bigrams tf-ipf pre- vs. post-war period}

##### ENVIRO-LABOR #####

enviroLabor_oneRowPerDocument_pre_vs_post_war <- enviroLaborBigrams_count %>%
  mutate(period = case_when(year >= 1875 & year <= 1945 ~ "1875-1945",
                            year > 1945 ~ "1946-present")) %>%
  group_by(period, term) %>%
  dplyr::summarize(count = sum(n)) %>%
  ungroup() %>%
  mutate(id_number = period) %>%
  filter(!is.na(period)) %>%
  filter(!is.na(term)) %>%
  filter(!is.na(id_number))

enviroLabor_tfidf_pre_vs_post_war <- enviroLabor_oneRowPerDocument_pre_vs_post_war %>%
  bind_tf_idf(term, id_number, count) %>%
  group_by(period) %>%
  arrange(desc(tf_idf)) %>%
  slice(seq_len(25)) %>%
  ungroup() 

#### pre- vs. post-war
top_enviroLaborBigrams_pre_vs_post_war <- ggplot() +
  geom_col(data=enviroLabor_tfidf_pre_vs_post_war,
           aes(y=count,
               x = reorder_within(term, 
                                  count, 
                                  period, 
                                  fun = sum),
               text = paste("<b>",term,"</b>",
                            "<br>count: ",
                            count,
                            "<br>tf_idf: ",
                            signif(tf_idf,2),
                            sep="")),
           fill="blueviolet") +
  facet_wrap(~period, scales = "free", ncol=2) +
  scale_x_reordered() +
  coord_flip() +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(title = "",
       y = "count",
       x = "") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_pre_vs_post_war, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("congress_bookdown/figures/tfipf_enviroLaborBigrams_pre_vs_post_war.html",selfcontained = F, libdir = "lib")

```

##### 25-year period 
```{r enviroLabor bigrams tf-ipf per 25-yr period}

##### ENVIRO-LABOR #####

enviroLabor_oneRowPerDocument_25yr <- enviroLaborBigrams_count %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 25) %>%
  group_by(period, term) %>%
  dplyr::summarize(count = sum(n)) %>%
  ungroup() %>%
  mutate(id_number = period) %>%
  filter(!is.na(period)) %>%
  filter(!is.na(term)) %>%
  filter(!is.na(id_number))

enviroLabor_tfidf_25yr <- enviroLabor_oneRowPerDocument_25yr %>%
  bind_tf_idf(term, id_number, count) %>%
  group_by(period) %>%
  arrange(desc(tf_idf)) %>%
  slice(seq_len(25)) %>%
  ungroup() 


#### 1875 & 1900
top_enviroLaborBigrams_25yr_1875_1900 <- ggplot() +
  geom_col(data=filter(enviroLabor_tfidf_25yr,period==1875 | period==1900),
           aes(y=count,
               x = reorder_within(term, 
                                  count, 
                                  period, 
                                  fun = sum),
               text = paste("<b>",term,"</b>",
                            "<br>count: ",
                            count,
                            "<br>tf_idf: ",
                            signif(tf_idf,2),
                            sep="")),
           fill="blueviolet") +
  facet_wrap(~period, scales = "free", ncol=2) +
  scale_x_reordered() +
  coord_flip() +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(title = "",
       y = "count",
       x = "") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_25yr_1875_1900, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("congress_bookdown/figures/tfipf_enviroLaborBigrams_25yr_1875_1900.html",selfcontained = F, libdir = "lib")


#### 1925 & 1950
top_enviroLaborBigrams_25yr_1925_1950 <- ggplot() +
  geom_col(data=filter(enviroLabor_tfidf_25yr,period==1925 | period==1950),
           aes(y=count,
               x = reorder_within(term, 
                                  count, 
                                  period, 
                                  fun = sum),
               text = paste("<b>",term,"</b>",
                            "<br>count: ",
                            count,
                            "<br>tf_idf: ",
                            signif(tf_idf,2),
                            sep="")),
           fill="blueviolet") +
  facet_wrap(~period, scales = "free", ncol=2) +
  scale_x_reordered() +
  coord_flip() +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(title = "",
       y = "count",
       x = "") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_25yr_1925_1950, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("congress_bookdown/figures/tfipf_enviroLaborBigrams_25yr_1925_1950.html",selfcontained = F, libdir = "lib")


#### 1975 & 2000
top_enviroLaborBigrams_25yr_1975_2000 <- ggplot() +
  geom_col(data=filter(enviroLabor_tfidf_25yr,period==1975 | period==2000),
           aes(y=count,
               x = reorder_within(term, 
                                  count, 
                                  period, 
                                  fun = sum),
               text = paste("<b>",term,"</b>",
                            "<br>count: ",
                            count,
                            "<br>tf_idf: ",
                            signif(tf_idf,2),
                            sep="")),
           fill="blueviolet") +
  facet_wrap(~period, scales = "free", ncol=2) +
  scale_x_reordered() +
  coord_flip() +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(title = "",
       y = "count",
       x = "") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_25yr_1975_2000, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("congress_bookdown/figures/tfipf_enviroLaborBigrams_25yr_1975_2000.html",selfcontained = F, libdir = "lib")

```

##### 20-year period
```{r enviroLabor bigrams tf-ipf per 20-yr period}

##### ENVIRO-LABOR #####

enviroLabor_oneRowPerDocument_20yr <- enviroLaborBigrams_count %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 20) %>%
  group_by(period, term) %>%
  dplyr::summarize(count = sum(n)) %>%
  ungroup() %>%
  mutate(id_number = period) %>%
  filter(!is.na(period)) %>%
  filter(!is.na(term)) %>%
  filter(!is.na(id_number))

enviroLabor_tfidf_20yr <- enviroLabor_oneRowPerDocument_20yr %>%
  bind_tf_idf(term, id_number, count) %>%
  group_by(period) %>%
  arrange(desc(tf_idf)) %>%
  slice(seq_len(25)) %>%
  ungroup() 


#### 1900 & 1920
top_enviroLaborBigrams_20yr_1900_1920 <- ggplot() +
  geom_col(data=filter(enviroLabor_tfidf_20yr,period==1900 | period==1920),
           aes(y=count,
               x = reorder_within(term, 
                                  count, 
                                  period, 
                                  fun = sum),
               text = paste("<b>",term,"</b>",
                            "<br>count: ",
                            count,
                            "<br>tf_idf: ",
                            signif(tf_idf,2),
                            sep="")),
           fill="blueviolet") +
  facet_wrap(~period, scales = "free", ncol=2) +
  scale_x_reordered() +
  coord_flip() +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(title = "",
       y = "count",
       x = "") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_20yr_1900_1920, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("congress_bookdown/figures/tfipf_enviroLaborBigrams_20yr_1900_1920.html",selfcontained = F, libdir = "lib")


#### 1940 & 1960
top_enviroLaborBigrams_20yr_1940_1960 <- ggplot() +
  geom_col(data=filter(enviroLabor_tfidf_20yr,period==1940 | period==1960),
           aes(y=count,
               x = reorder_within(term, 
                                  count, 
                                  period, 
                                  fun = sum),
               text = paste("<b>",term,"</b>",
                            "<br>count: ",
                            count,
                            "<br>tf_idf: ",
                            signif(tf_idf,2),
                            sep="")),
           fill="blueviolet") +
  facet_wrap(~period, scales = "free", ncol=2) +
  scale_x_reordered() +
  coord_flip() +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(title = "",
       y = "count",
       x = "") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_20yr_1940_1960, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("congress_bookdown/figures/tfipf_enviroLaborBigrams_20yr_1940_1960.html",selfcontained = F, libdir = "lib")


#### 1980 & 2000
top_enviroLaborBigrams_20yr_1980_2000 <- ggplot() +
  geom_col(data=filter(enviroLabor_tfidf_20yr,period==1980 | period==2000),
           aes(y=count,
               x = reorder_within(term, 
                                  count, 
                                  period, 
                                  fun = sum),
               text = paste("<b>",term,"</b>",
                            "<br>count: ",
                            count,
                            "<br>tf_idf: ",
                            signif(tf_idf,2),
                            sep="")),
           fill="blueviolet") +
  facet_wrap(~period, scales = "free", ncol=2) +
  scale_x_reordered() +
  coord_flip() +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(title = "",
       y = "count",
       x = "") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_20yr_1980_2000, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("congress_bookdown/figures/tfipf_enviroLaborBigrams_20yr_1980_2000.html",selfcontained = F, libdir = "lib")

```

##### 15-year period 
```{r enviroLabor bigrams tf-ipf per 15-yr period}

##### ENVIRO-LABOR #####

enviroLabor_oneRowPerDocument_15yr <- enviroLaborBigrams_count %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 15) %>%
  group_by(period, term) %>%
  dplyr::summarize(count = sum(n)) %>%
  ungroup() %>%
  mutate(id_number = period) %>%
  filter(!is.na(period)) %>%
  filter(!is.na(term)) %>%
  filter(!is.na(id_number))

enviroLabor_tfidf_15yr <- enviroLabor_oneRowPerDocument_15yr %>%
  bind_tf_idf(term, id_number, count) %>%
  group_by(period) %>%
  arrange(desc(tf_idf)) %>%
  slice(seq_len(25)) %>%
  ungroup() 


#### 1875 & 1890
top_enviroLaborBigrams_15yr_1875_1890 <- ggplot() +
  geom_col(data=filter(enviroLabor_tfidf_15yr,period==1875 | period==1890),
           aes(y=count,
               x = reorder_within(term, 
                                  count, 
                                  period, 
                                  fun = sum),
               text = paste("<b>",term,"</b>",
                            "<br>count: ",
                            count,
                            "<br>tf_idf: ",
                            signif(tf_idf,2),
                            sep="")),
           fill="blueviolet") +
  facet_wrap(~period, scales = "free", ncol=2) +
  scale_x_reordered() +
  coord_flip() +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(title = "",
       y = "count",
       x = "") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_15yr_1875_1890, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("congress_bookdown/figures/tfipf_enviroLaborBigrams_15yr_1875_1890.html",selfcontained = F, libdir = "lib")



#### 1905 & 1920
top_enviroLaborBigrams_15yr_1905_1920 <- ggplot() +
  geom_col(data=filter(enviroLabor_tfidf_15yr,period==1905 | period==1920),
           aes(y=count,
               x = reorder_within(term, 
                                  count, 
                                  period, 
                                  fun = sum),
               text = paste("<b>",term,"</b>",
                            "<br>count: ",
                            count,
                            "<br>tf_idf: ",
                            signif(tf_idf,2),
                            sep="")),
           fill="blueviolet") +
  facet_wrap(~period, scales = "free", ncol=2) +
  scale_x_reordered() +
  coord_flip() +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(title = "",
       y = "count",
       x = "") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_15yr_1905_1920, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("congress_bookdown/figures/tfipf_enviroLaborBigrams_15yr_1905_1920.html",selfcontained = F, libdir = "lib")



#### 1935 & 1950
top_enviroLaborBigrams_15yr_1935_1950 <- ggplot() +
  geom_col(data=filter(enviroLabor_tfidf_15yr,period==1935 | period==1950),
           aes(y=count,
               x = reorder_within(term, 
                                  count, 
                                  period, 
                                  fun = sum),
               text = paste("<b>",term,"</b>",
                            "<br>count: ",
                            count,
                            "<br>tf_idf: ",
                            signif(tf_idf,2),
                            sep="")),
           fill="blueviolet") +
  facet_wrap(~period, scales = "free", ncol=2) +
  scale_x_reordered() +
  coord_flip() +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(title = "",
       y = "count",
       x = "") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_15yr_1935_1950, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("congress_bookdown/figures/tfipf_enviroLaborBigrams_15yr_1935_1950.html",selfcontained = F, libdir = "lib")


#### 1965 & 1980
top_enviroLaborBigrams_15yr_1965_1980 <- ggplot() +
  geom_col(data=filter(enviroLabor_tfidf_15yr,period==1965 | period==1980),
           aes(y=count,
               x = reorder_within(term, 
                                  count, 
                                  period, 
                                  fun = sum),
               text = paste("<b>",term,"</b>",
                            "<br>count: ",
                            count,
                            "<br>tf_idf: ",
                            signif(tf_idf,2),
                            sep="")),
           fill="blueviolet") +
  facet_wrap(~period, scales = "free", ncol=2) +
  scale_x_reordered() +
  coord_flip() +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(title = "",
       y = "count",
       x = "") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_15yr_1965_1980, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("congress_bookdown/figures/tfipf_enviroLaborBigrams_15yr_1965_1980.html",selfcontained = F, libdir = "lib")


#### 1995 & 2010
top_enviroLaborBigrams_15yr_1995_2010 <- ggplot() +
  geom_col(data=filter(enviroLabor_tfidf_15yr,period==1995 | period==2010),
           aes(y=count,
               x = reorder_within(term, 
                                  count, 
                                  period, 
                                  fun = sum),
               text = paste("<b>",term,"</b>",
                            "<br>count: ",
                            count,
                            "<br>tf_idf: ",
                            signif(tf_idf,2),
                            sep="")),
           fill="blueviolet") +
  facet_wrap(~period, scales = "free", ncol=2) +
  scale_x_reordered() +
  coord_flip() +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(title = "",
       y = "count",
       x = "") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_15yr_1995_2010, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("congress_bookdown/figures/tfipf_enviroLaborBigrams_15yr_1995_2010.html",selfcontained = F, libdir = "lib")


```

##### 10-year period 
```{r enviroLabor bigrams tf-ipf per 10-yr period}

##### ENVIRO-LABOR #####

enviroLabor_oneRowPerDocument_10yr <- enviroLaborBigrams_count %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 10) %>%
  group_by(period, term) %>%
  dplyr::summarize(count = sum(n)) %>%
  ungroup() %>%
  mutate(id_number = period) %>%
  filter(!is.na(period)) %>%
  filter(!is.na(term)) %>%
  filter(!is.na(id_number))

enviroLabor_tfidf_10yr <- enviroLabor_oneRowPerDocument_10yr %>%
  bind_tf_idf(term, id_number, count) %>%
  group_by(period) %>%
  arrange(desc(tf_idf)) %>%
  slice(seq_len(25)) %>%
  ungroup() 


#### 1890 & 1900
top_enviroLaborBigrams_10yr_1890_1900 <- ggplot() +
  geom_col(data=filter(enviroLabor_tfidf_10yr,period==1890 | period==1900),
           aes(y=count,
               x = reorder_within(term, 
                                  count, 
                                  period, 
                                  fun = sum),
               text = paste("<b>",term,"</b>",
                            "<br>count: ",
                            count,
                            "<br>tf_idf: ",
                            signif(tf_idf,2),
                            sep="")),
           fill="blueviolet") +
  facet_wrap(~period, scales = "free", ncol=2) +
  scale_x_reordered() +
  coord_flip() +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(title = "",
       y = "count",
       x = "") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_10yr_1890_1900, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("congress_bookdown/figures/tfipf_enviroLaborBigrams_10yr_1890_1900.html",selfcontained = F, libdir = "lib")



#### 1910 & 1920
top_enviroLaborBigrams_10yr_1910_1920 <- ggplot() +
  geom_col(data=filter(enviroLabor_tfidf_10yr,period==1910 | period==1920),
           aes(y=count,
               x = reorder_within(term, 
                                  count, 
                                  period, 
                                  fun = sum),
               text = paste("<b>",term,"</b>",
                            "<br>count: ",
                            count,
                            "<br>tf_idf: ",
                            signif(tf_idf,2),
                            sep="")),
           fill="blueviolet") +
  facet_wrap(~period, scales = "free", ncol=2) +
  scale_x_reordered() +
  coord_flip() +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(title = "",
       y = "count",
       x = "") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_10yr_1910_1920, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("congress_bookdown/figures/tfipf_enviroLaborBigrams_10yr_1910_1920.html",selfcontained = F, libdir = "lib")



#### 1930 & 1940
top_enviroLaborBigrams_10yr_1930_1940 <- ggplot() +
  geom_col(data=filter(enviroLabor_tfidf_10yr,period==1930 | period==1940),
           aes(y=count,
               x = reorder_within(term, 
                                  count, 
                                  period, 
                                  fun = sum),
               text = paste("<b>",term,"</b>",
                            "<br>count: ",
                            count,
                            "<br>tf_idf: ",
                            signif(tf_idf,2),
                            sep="")),
           fill="blueviolet") +
  facet_wrap(~period, scales = "free", ncol=2) +
  scale_x_reordered() +
  coord_flip() +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(title = "",
       y = "count",
       x = "") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_10yr_1930_1940, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("congress_bookdown/figures/tfipf_enviroLaborBigrams_10yr_1930_1940.html",selfcontained = F, libdir = "lib")



#### 1950 & 1960
top_enviroLaborBigrams_10yr_1950_1960 <- ggplot() +
  geom_col(data=filter(enviroLabor_tfidf_10yr,period==1950 | period==1960),
           aes(y=count,
               x = reorder_within(term, 
                                  count, 
                                  period, 
                                  fun = sum),
               text = paste("<b>",term,"</b>",
                            "<br>count: ",
                            count,
                            "<br>tf_idf: ",
                            signif(tf_idf,2),
                            sep="")),
           fill="blueviolet") +
  facet_wrap(~period, scales = "free", ncol=2) +
  scale_x_reordered() +
  coord_flip() +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(title = "",
       y = "count",
       x = "") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_10yr_1950_1960, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("congress_bookdown/figures/tfipf_enviroLaborBigrams_10yr_1950_1960.html",selfcontained = F, libdir = "lib")



#### 1970 & 1980
top_enviroLaborBigrams_10yr_1970_1980 <- ggplot() +
  geom_col(data=filter(enviroLabor_tfidf_10yr,period==1970 | period==1980),
           aes(y=count,
               x = reorder_within(term, 
                                  count, 
                                  period, 
                                  fun = sum),
               text = paste("<b>",term,"</b>",
                            "<br>count: ",
                            count,
                            "<br>tf_idf: ",
                            signif(tf_idf,2),
                            sep="")),
           fill="blueviolet") +
  facet_wrap(~period, scales = "free", ncol=2) +
  scale_x_reordered() +
  coord_flip() +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(title = "",
       y = "count",
       x = "") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_10yr_1970_1980, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("congress_bookdown/figures/tfipf_enviroLaborBigrams_10yr_1970_1980.html",selfcontained = F, libdir = "lib")



#### 1990 & 2000
top_enviroLaborBigrams_10yr_1990_2000 <- ggplot() +
  geom_col(data=filter(enviroLabor_tfidf_10yr,period==1990 | period==2000),
           aes(y=count,
               x = reorder_within(term, 
                                  count, 
                                  period, 
                                  fun = sum),
               text = paste("<b>",term,"</b>",
                            "<br>count: ",
                            count,
                            "<br>tf_idf: ",
                            signif(tf_idf,2),
                            sep="")),
           fill="blueviolet") +
  facet_wrap(~period, scales = "free", ncol=2) +
  scale_x_reordered() +
  coord_flip() +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(title = "",
       y = "count",
       x = "") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_10yr_1990_2000, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("congress_bookdown/figures/tfipf_enviroLaborBigrams_10yr_1990_2000.html",selfcontained = F, libdir = "lib")



#### 2010 & 2020
top_enviroLaborBigrams_10yr_2010_2020 <- ggplot() +
  geom_col(data=filter(enviroLabor_tfidf_10yr,period==2010 | period==2020),
           aes(y=count,
               x = reorder_within(term, 
                                  count, 
                                  period, 
                                  fun = sum),
               text = paste("<b>",term,"</b>",
                            "<br>count: ",
                            count,
                            "<br>tf_idf: ",
                            signif(tf_idf,2),
                            sep="")),
           fill="blueviolet") +
  facet_wrap(~period, scales = "free", ncol=2) +
  scale_x_reordered() +
  coord_flip() +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(title = "",
       y = "count",
       x = "") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_10yr_2010_2020, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("congress_bookdown/figures/tfipf_enviroLaborBigrams_10yr_2010_2020.html",selfcontained = F, libdir = "lib")


```


## CO-OCCURRENCE NETWORKS

```{r SET-UP co-occurrence with enviroLabor keywords, include=FALSE}

laborVocab_simple <- c("^labor$",
                       "^worker$",
                       "^job$",
                       "^wage$")

enviroVocab_simple <- c("^environ",
                        "^ecolog",
                        "^ecosyst",
                        "^pollut",
                        "^wildlif",
                        "^wilder")

enviroLaborVocabString_simple <- c(laborVocab_simple,
                                   enviroVocab_simple) %>%
  paste(collapse = "|") %>%
  str_replace_all(" ","[:blank:]")



laborBigramVocab_simple <- c("^labor_","_labor$",
                       "^worker_","_worker$",
                       "^job_","_job$",
                       "^wage_","_wage$")

enviroBigramVocab_simple <- c("^environ","_environ",
                        "^ecolog","_ecolog",
                        "^ecosyst","_ecosyst",
                        "^pollut","_pollut",
                        "^wildlif","_wildlif",
                        "^wilder","_wilder")

enviroLaborBigramVocabString_simple <- c(laborBigramVocab_simple,
                                         enviroBigramVocab_simple) %>%
  paste(collapse = "|") %>%
  str_replace_all(" ","[:blank:]")

```


#### tokens

##### 25-yr period:
```{r enviroLabor token co-occurence per 25-yr period}

#### 1875
enviroLaborTokens_wordPairs_corr_25yr_1875 <- enviroLaborTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 25) %>%
  filter(period==1875) %>%
  group_by(term) %>%
  filter(n() >= 25) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(item1 %ilike% enviroLaborVocabString_simple) %>%
  slice_max(correlation,n=85) %>%
  arrange(-correlation)

set.seed(2016)
enviroLaborTokens_wordPairs_corr_25yr_1875 %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha=correlation), 
                 edge_color="#32127a",
                 show.legend=TRUE) +
  geom_node_point(color="blueviolet", size=3.5) +
  geom_node_text(aes(label=name), 
                 color="#32127a",
                 family="IBM Plex Mono",
                 size=3,
                 repel = TRUE) +
  theme_void() + 
  theme(legend.text=element_text(family="IBM Plex Mono",color="#32127a"),
        legend.title=element_text(family="IBM Plex Mono",color="#32127a"))

ggsave("congress_bookdown/figures/enviroLaborTokens_wordPairs_corr_25yr_1875.jpg") #h=11,



#### 1900
enviroLaborTokens_wordPairs_corr_25yr_1900 <- enviroLaborTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 25) %>%
  filter(period==1900) %>%
  group_by(term) %>%
  filter(n() >= 25) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(item1 %ilike% enviroLaborVocabString_simple) %>%
  slice_max(correlation,n=85) %>%
  arrange(-correlation)

set.seed(2016)
enviroLaborTokens_wordPairs_corr_25yr_1900 %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha=correlation), 
                 edge_color="#32127a",
                 show.legend=TRUE) +
  geom_node_point(color="blueviolet", size=3.5) +
  geom_node_text(aes(label=name), 
                 color="#32127a",
                 family="IBM Plex Mono",
                 size=3,
                 repel = TRUE) +
  theme_void() + 
  theme(legend.text=element_text(family="IBM Plex Mono",color="#32127a"),
        legend.title=element_text(family="IBM Plex Mono",color="#32127a"))

ggsave("congress_bookdown/figures/enviroLaborTokens_wordPairs_corr_25yr_1900.jpg") #h=11,



#### 1925
enviroLaborTokens_wordPairs_corr_25yr_1925 <- enviroLaborTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 25) %>%
  filter(period==1925) %>%
  group_by(term) %>%
  filter(n() >= 25) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(item1 %ilike% enviroLaborVocabString_simple) %>%
  slice_max(correlation,n=85) %>%
  arrange(-correlation)

set.seed(2016)
enviroLaborTokens_wordPairs_corr_25yr_1925 %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha=correlation), 
                 edge_color="#32127a",
                 show.legend=TRUE) +
  geom_node_point(color="blueviolet", size=3.5) +
  geom_node_text(aes(label=name), 
                 color="#32127a",
                 family="IBM Plex Mono",
                 size=3,
                 repel = TRUE) +
  theme_void() + 
  theme(legend.text=element_text(family="IBM Plex Mono",color="#32127a"),
        legend.title=element_text(family="IBM Plex Mono",color="#32127a"))

ggsave("congress_bookdown/figures/enviroLaborTokens_wordPairs_corr_25yr_1925.jpg") #h=11,



#### 1950
enviroLaborTokens_wordPairs_corr_25yr_1950 <- enviroLaborTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 25) %>%
  filter(period==1950) %>%
  group_by(term) %>%
  filter(n() >= 25) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(item1 %ilike% enviroLaborVocabString_simple) %>%
  slice_max(correlation,n=85) %>%
  arrange(-correlation)

set.seed(2016)
enviroLaborTokens_wordPairs_corr_25yr_1950 %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha=correlation), 
                 edge_color="#32127a",
                 show.legend=TRUE) +
  geom_node_point(color="blueviolet", size=3.5) +
  geom_node_text(aes(label=name), 
                 color="#32127a",
                 family="IBM Plex Mono",
                 size=3,
                 repel = TRUE) +
  theme_void() + 
  theme(legend.text=element_text(family="IBM Plex Mono",color="#32127a"),
        legend.title=element_text(family="IBM Plex Mono",color="#32127a"))

ggsave("congress_bookdown/figures/enviroLaborTokens_wordPairs_corr_25yr_1950.jpg") #h=11,



#### 1975
enviroLaborTokens_wordPairs_corr_25yr_1975 <- enviroLaborTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 25) %>%
  filter(period==1975) %>%
  group_by(term) %>%
  filter(n() >= 25) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(item1 %ilike% enviroLaborVocabString_simple) %>%
  slice_max(correlation,n=85) %>%
  arrange(-correlation)

set.seed(2016)
enviroLaborTokens_wordPairs_corr_25yr_1975 %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha=correlation), 
                 edge_color="#32127a",
                 show.legend=TRUE) +
  geom_node_point(color="blueviolet", size=3.5) +
  geom_node_text(aes(label=name), 
                 color="#32127a",
                 family="IBM Plex Mono",
                 size=3,
                 repel = TRUE) +
  theme_void() + 
  theme(legend.text=element_text(family="IBM Plex Mono",color="#32127a"),
        legend.title=element_text(family="IBM Plex Mono",color="#32127a"))

ggsave("congress_bookdown/figures/enviroLaborTokens_wordPairs_corr_25yr_1975.jpg") #h=11,




#### 2000
enviroLaborTokens_wordPairs_corr_25yr_2000 <- enviroLaborTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 25) %>%
  filter(period==2000) %>%
  group_by(term) %>%
  filter(n() >= 25) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(item1 %ilike% enviroLaborVocabString_simple) %>%
  slice_max(correlation,n=85) %>%
  arrange(-correlation)

set.seed(2016)
enviroLaborTokens_wordPairs_corr_25yr_2000 %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha=correlation), 
                 edge_color="#32127a",
                 show.legend=TRUE) +
  geom_node_point(color="blueviolet", size=3.5) +
  geom_node_text(aes(label=name), 
                 color="#32127a",
                 family="IBM Plex Mono",
                 size=3,
                 repel = TRUE) +
  theme_void() + 
  theme(legend.text=element_text(family="IBM Plex Mono",color="#32127a"),
        legend.title=element_text(family="IBM Plex Mono",color="#32127a"))

ggsave("congress_bookdown/figures/enviroLaborTokens_wordPairs_corr_25yr_2000.jpg") #h=11,



```

##### 10-yr period:
```{r enviroLabor token co-occurence with enviroLabor per 10-yr period}


#### 1900
enviroLaborTokens_wordPairs_corr_10yr_1900 <- enviroLaborTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 10) %>%
  filter(period==1900) %>%
  group_by(term) %>%
  filter(n() >= 10) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(item1 %ilike% enviroLaborVocabString_simple) %>%
  slice_max(correlation,n=85) %>%
  arrange(-correlation)

set.seed(2016)
enviroLaborTokens_wordPairs_corr_10yr_1900 %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha=correlation), 
                 edge_color="#32127a",
                 show.legend=TRUE) +
  geom_node_point(color="blueviolet", size=3.5) +
  geom_node_text(aes(label=name), 
                 color="#32127a",
                 family="IBM Plex Mono",
                 size=3,
                 repel = TRUE) +
  theme_void() + 
  theme(legend.text=element_text(family="IBM Plex Mono",color="#32127a"),
        legend.title=element_text(family="IBM Plex Mono",color="#32127a"))

ggsave("congress_bookdown/figures/enviroLaborTokens_wordPairs_corr_10yr_1900.jpg") #h=11,



#### 1910
enviroLaborTokens_wordPairs_corr_10yr_1910 <- enviroLaborTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 10) %>%
  filter(period==1910) %>%
  group_by(term) %>%
  filter(n() >= 10) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(item1 %ilike% enviroLaborVocabString_simple) %>%
  slice_max(correlation,n=85) %>%
  arrange(-correlation)

set.seed(2016)
enviroLaborTokens_wordPairs_corr_10yr_1910 %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha=correlation), 
                 edge_color="#32127a",
                 show.legend=TRUE) +
  geom_node_point(color="blueviolet", size=3.5) +
  geom_node_text(aes(label=name), 
                 color="#32127a",
                 family="IBM Plex Mono",
                 size=3,
                 repel = TRUE) +
  theme_void() + 
  theme(legend.text=element_text(family="IBM Plex Mono",color="#32127a"),
        legend.title=element_text(family="IBM Plex Mono",color="#32127a"))

ggsave("congress_bookdown/figures/enviroLaborTokens_wordPairs_corr_10yr_1910.jpg") #h=11,



#### 1920
enviroLaborTokens_wordPairs_corr_10yr_1920 <- enviroLaborTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 10) %>%
  filter(period==1920) %>%
  group_by(term) %>%
  filter(n() >= 10) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(item1 %ilike% enviroLaborVocabString_simple) %>%
  slice_max(correlation,n=85) %>%
  arrange(-correlation)

set.seed(2016)
enviroLaborTokens_wordPairs_corr_10yr_1920 %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha=correlation), 
                 edge_color="#32127a",
                 show.legend=TRUE) +
  geom_node_point(color="blueviolet", size=3.5) +
  geom_node_text(aes(label=name), 
                 color="#32127a",
                 family="IBM Plex Mono",
                 size=3,
                 repel = TRUE) +
  theme_void() + 
  theme(legend.text=element_text(family="IBM Plex Mono",color="#32127a"),
        legend.title=element_text(family="IBM Plex Mono",color="#32127a"))

ggsave("congress_bookdown/figures/enviroLaborTokens_wordPairs_corr_10yr_1920.jpg") #h=11,



#### 1930
enviroLaborTokens_wordPairs_corr_10yr_1930 <- enviroLaborTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 10) %>%
  filter(period==1930) %>%
  group_by(term) %>%
  filter(n() >= 10) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(item1 %ilike% enviroLaborVocabString_simple) %>%
  slice_max(correlation,n=85) %>%
  arrange(-correlation)

set.seed(2016)
enviroLaborTokens_wordPairs_corr_10yr_1930 %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha=correlation), 
                 edge_color="#32127a",
                 show.legend=TRUE) +
  geom_node_point(color="blueviolet", size=3.5) +
  geom_node_text(aes(label=name), 
                 color="#32127a",
                 family="IBM Plex Mono",
                 size=3,
                 repel = TRUE) +
  theme_void() + 
  theme(legend.text=element_text(family="IBM Plex Mono",color="#32127a"),
        legend.title=element_text(family="IBM Plex Mono",color="#32127a"))

ggsave("congress_bookdown/figures/enviroLaborTokens_wordPairs_corr_10yr_1930.jpg") #h=11,



#### 1940
enviroLaborTokens_wordPairs_corr_10yr_1940 <- enviroLaborTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 10) %>%
  filter(period==1940) %>%
  group_by(term) %>%
  filter(n() >= 10) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(item1 %ilike% enviroLaborVocabString_simple) %>%
  slice_max(correlation,n=85) %>%
  arrange(-correlation)

set.seed(2016)
enviroLaborTokens_wordPairs_corr_10yr_1940 %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha=correlation), 
                 edge_color="#32127a",
                 show.legend=TRUE) +
  geom_node_point(color="blueviolet", size=3.5) +
  geom_node_text(aes(label=name), 
                 color="#32127a",
                 family="IBM Plex Mono",
                 size=3,
                 repel = TRUE) +
  theme_void() + 
  theme(legend.text=element_text(family="IBM Plex Mono",color="#32127a"),
        legend.title=element_text(family="IBM Plex Mono",color="#32127a"))

ggsave("congress_bookdown/figures/enviroLaborTokens_wordPairs_corr_10yr_1940.jpg") #h=11,



#### 1950
enviroLaborTokens_wordPairs_corr_10yr_1950 <- enviroLaborTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 10) %>%
  filter(period==1950) %>%
  group_by(term) %>%
  filter(n() >= 10) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(item1 %ilike% enviroLaborVocabString_simple) %>%
  slice_max(correlation,n=85) %>%
  arrange(-correlation)

set.seed(2016)
enviroLaborTokens_wordPairs_corr_10yr_1950 %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha=correlation), 
                 edge_color="#32127a",
                 show.legend=TRUE) +
  geom_node_point(color="blueviolet", size=3.5) +
  geom_node_text(aes(label=name), 
                 color="#32127a",
                 family="IBM Plex Mono",
                 size=3,
                 repel = TRUE) +
  theme_void() + 
  theme(legend.text=element_text(family="IBM Plex Mono",color="#32127a"),
        legend.title=element_text(family="IBM Plex Mono",color="#32127a"))

ggsave("congress_bookdown/figures/enviroLaborTokens_wordPairs_corr_10yr_1950.jpg") #h=11,




#### 1960
enviroLaborTokens_wordPairs_corr_10yr_1960 <- enviroLaborTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 10) %>%
  filter(period==1960) %>%
  group_by(term) %>%
  filter(n() >= 10) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(item1 %ilike% enviroLaborVocabString_simple) %>%
  slice_max(correlation,n=85) %>%
  arrange(-correlation)

set.seed(2016)
enviroLaborTokens_wordPairs_corr_10yr_1960 %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha=correlation), 
                 edge_color="#32127a",
                 show.legend=TRUE) +
  geom_node_point(color="blueviolet", size=3.5) +
  geom_node_text(aes(label=name), 
                 color="#32127a",
                 family="IBM Plex Mono",
                 size=3,
                 repel = TRUE) +
  theme_void() + 
  theme(legend.text=element_text(family="IBM Plex Mono",color="#32127a"),
        legend.title=element_text(family="IBM Plex Mono",color="#32127a"))

ggsave("congress_bookdown/figures/enviroLaborTokens_wordPairs_corr_10yr_1960.jpg") #h=11,




#### 1970
enviroLaborTokens_wordPairs_corr_10yr_1970 <- enviroLaborTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 10) %>%
  filter(period==1970) %>%
  group_by(term) %>%
  filter(n() >= 10) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(item1 %ilike% enviroLaborVocabString_simple) %>%
  slice_max(correlation,n=85) %>%
  arrange(-correlation)

set.seed(2016)
enviroLaborTokens_wordPairs_corr_10yr_1970 %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha=correlation), 
                 edge_color="#32127a",
                 show.legend=TRUE) +
  geom_node_point(color="blueviolet", size=3.5) +
  geom_node_text(aes(label=name), 
                 color="#32127a",
                 family="IBM Plex Mono",
                 size=3,
                 repel = TRUE) +
  theme_void() + 
  theme(legend.text=element_text(family="IBM Plex Mono",color="#32127a"),
        legend.title=element_text(family="IBM Plex Mono",color="#32127a"))

ggsave("congress_bookdown/figures/enviroLaborTokens_wordPairs_corr_10yr_1970.jpg") #h=11,



#### 1980
enviroLaborTokens_wordPairs_corr_10yr_1980 <- enviroLaborTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 10) %>%
  filter(period==1980) %>%
  group_by(term) %>%
  filter(n() >= 10) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(item1 %ilike% enviroLaborVocabString_simple) %>%
  slice_max(correlation,n=85) %>%
  arrange(-correlation)

set.seed(2016)
enviroLaborTokens_wordPairs_corr_10yr_1980 %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha=correlation), 
                 edge_color="#32127a",
                 show.legend=TRUE) +
  geom_node_point(color="blueviolet", size=3.5) +
  geom_node_text(aes(label=name), 
                 color="#32127a",
                 family="IBM Plex Mono",
                 size=3,
                 repel = TRUE) +
  theme_void() + 
  theme(legend.text=element_text(family="IBM Plex Mono",color="#32127a"),
        legend.title=element_text(family="IBM Plex Mono",color="#32127a"))

ggsave("congress_bookdown/figures/enviroLaborTokens_wordPairs_corr_10yr_1980.jpg") #h=11,




#### 1990
enviroLaborTokens_wordPairs_corr_10yr_1990 <- enviroLaborTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 10) %>%
  filter(period==1990) %>%
  group_by(term) %>%
  filter(n() >= 10) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(item1 %ilike% enviroLaborVocabString_simple) %>%
  slice_max(correlation,n=85) %>%
  arrange(-correlation)

set.seed(2016)
enviroLaborTokens_wordPairs_corr_10yr_1990 %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha=correlation), 
                 edge_color="#32127a",
                 show.legend=TRUE) +
  geom_node_point(color="blueviolet", size=3.5) +
  geom_node_text(aes(label=name), 
                 color="#32127a",
                 family="IBM Plex Mono",
                 size=3,
                 repel = TRUE) +
  theme_void() + 
  theme(legend.text=element_text(family="IBM Plex Mono",color="#32127a"),
        legend.title=element_text(family="IBM Plex Mono",color="#32127a"))

ggsave("congress_bookdown/figures/enviroLaborTokens_wordPairs_corr_10yr_1990.jpg") #h=11,



#### 2000
enviroLaborTokens_wordPairs_corr_10yr_2000 <- enviroLaborTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 10) %>%
  filter(period==2000) %>%
  group_by(term) %>%
  filter(n() >= 10) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(item1 %ilike% enviroLaborVocabString_simple) %>%
  slice_max(correlation,n=85) %>%
  arrange(-correlation)

set.seed(2016)
enviroLaborTokens_wordPairs_corr_10yr_2000 %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha=correlation), 
                 edge_color="#32127a",
                 show.legend=TRUE) +
  geom_node_point(color="blueviolet", size=3.5) +
  geom_node_text(aes(label=name), 
                 color="#32127a",
                 family="IBM Plex Mono",
                 size=3,
                 repel = TRUE) +
  theme_void() + 
  theme(legend.text=element_text(family="IBM Plex Mono",color="#32127a"),
        legend.title=element_text(family="IBM Plex Mono",color="#32127a"))

ggsave("congress_bookdown/figures/enviroLaborTokens_wordPairs_corr_10yr_2000.jpg") #h=11,



#### 2010
enviroLaborTokens_wordPairs_corr_10yr_2010 <- enviroLaborTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 10) %>%
  filter(period==2010) %>%
  group_by(term) %>%
  filter(n() >= 10) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(item1 %ilike% enviroLaborVocabString_simple) %>%
  slice_max(correlation,n=85) %>%
  arrange(-correlation)

set.seed(2016)
enviroLaborTokens_wordPairs_corr_10yr_2010 %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha=correlation), 
                 edge_color="#32127a",
                 show.legend=TRUE) +
  geom_node_point(color="blueviolet", size=3.5) +
  geom_node_text(aes(label=name), 
                 color="#32127a",
                 family="IBM Plex Mono",
                 size=3,
                 repel = TRUE) +
  theme_void() + 
  theme(legend.text=element_text(family="IBM Plex Mono",color="#32127a"),
        legend.title=element_text(family="IBM Plex Mono",color="#32127a"))

ggsave("congress_bookdown/figures/enviroLaborTokens_wordPairs_corr_10yr_2010.jpg") #h=11,



#### 2020
enviroLaborTokens_wordPairs_corr_10yr_2020 <- enviroLaborTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 10) %>%
  filter(period==2020) %>%
  group_by(term) %>%
  filter(n() >= 5) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(item1 %ilike% enviroLaborVocabString_simple) %>%
  slice_max(correlation,n=85) %>%
  arrange(-correlation)

set.seed(2016)
enviroLaborTokens_wordPairs_corr_10yr_2020 %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha=correlation), 
                 edge_color="#32127a",
                 show.legend=TRUE) +
  geom_node_point(color="blueviolet", size=3.5) +
  geom_node_text(aes(label=name), 
                 color="#32127a",
                 family="IBM Plex Mono",
                 size=3,
                 repel = TRUE) +
  theme_void() + 
  theme(legend.text=element_text(family="IBM Plex Mono",color="#32127a"),
        legend.title=element_text(family="IBM Plex Mono",color="#32127a"))

ggsave("congress_bookdown/figures/enviroLaborTokens_wordPairs_corr_10yr_2020.jpg") #h=11,


```


#### bigrams

##### 25-yr period:
```{r enviroLabor bigram co-occurence with enviroLabor per 25-yr period}


#### 1875
enviroLaborBigrams_wordPairs_corr_25yr_1875 <- enviroLaborBigrams %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 25) %>%
  filter(period==1875) %>%
  group_by(term) %>%
  filter(n() >= 25) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(item1 %ilike% enviroLaborBigramVocabString_simple) %>%
  slice_max(correlation,n=85) %>%
  arrange(-correlation)

set.seed(2016)
enviroLaborBigrams_wordPairs_corr_25yr_1875 %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha=correlation), 
                 edge_color="#32127a",
                 show.legend=TRUE) +
  geom_node_point(color="blueviolet", size=3.5) +
  geom_node_text(aes(label=name), 
                 color="#32127a",
                 family="IBM Plex Mono",
                 size=3,
                 repel = TRUE) +
  theme_void() + 
  theme(legend.text=element_text(family="IBM Plex Mono",color="#32127a"),
        legend.title=element_text(family="IBM Plex Mono",color="#32127a"))

ggsave("congress_bookdown/figures/enviroLaborBigrams_wordPairs_corr_25yr_1875.jpg") #h=11,



#### 1900
enviroLaborBigrams_wordPairs_corr_25yr_1900 <- enviroLaborBigrams %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 25) %>%
  filter(period==1900) %>%
  group_by(term) %>%
  filter(n() >= 25) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(item1 %ilike% enviroLaborBigramVocabString_simple) %>%
  slice_max(correlation,n=85) %>%
  arrange(-correlation)

set.seed(2016)
enviroLaborBigrams_wordPairs_corr_25yr_1900 %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha=correlation), 
                 edge_color="#32127a",
                 show.legend=TRUE) +
  geom_node_point(color="blueviolet", size=3.5) +
  geom_node_text(aes(label=name), 
                 color="#32127a",
                 family="IBM Plex Mono",
                 size=3,
                 repel = TRUE) +
  theme_void() + 
  theme(legend.text=element_text(family="IBM Plex Mono",color="#32127a"),
        legend.title=element_text(family="IBM Plex Mono",color="#32127a"))

ggsave("congress_bookdown/figures/enviroLaborBigrams_wordPairs_corr_25yr_1900.jpg") #h=11,



#### 1925
enviroLaborBigrams_wordPairs_corr_25yr_1925 <- enviroLaborBigrams %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 25) %>%
  filter(period==1925) %>%
  group_by(term) %>%
  filter(n() >= 25) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(item1 %ilike% enviroLaborBigramVocabString_simple) %>%
  slice_max(correlation,n=85) %>%
  arrange(-correlation)

set.seed(2016)
enviroLaborBigrams_wordPairs_corr_25yr_1925 %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha=correlation), 
                 edge_color="#32127a",
                 show.legend=TRUE) +
  geom_node_point(color="blueviolet", size=3.5) +
  geom_node_text(aes(label=name), 
                 color="#32127a",
                 family="IBM Plex Mono",
                 size=3,
                 repel = TRUE) +
  theme_void() + 
  theme(legend.text=element_text(family="IBM Plex Mono",color="#32127a"),
        legend.title=element_text(family="IBM Plex Mono",color="#32127a"))

ggsave("congress_bookdown/figures/enviroLaborBigrams_wordPairs_corr_25yr_1925.jpg") #h=11,



#### 1950
enviroLaborBigrams_wordPairs_corr_25yr_1950 <- enviroLaborBigrams %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 25) %>%
  filter(period==1950) %>%
  group_by(term) %>%
  filter(n() >= 25) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(item1 %ilike% enviroLaborBigramVocabString_simple) %>%
  slice_max(correlation,n=85) %>%
  arrange(-correlation)

set.seed(2016)
enviroLaborBigrams_wordPairs_corr_25yr_1950 %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha=correlation), 
                 edge_color="#32127a",
                 show.legend=TRUE) +
  geom_node_point(color="blueviolet", size=3.5) +
  geom_node_text(aes(label=name), 
                 color="#32127a",
                 family="IBM Plex Mono",
                 size=3,
                 repel = TRUE) +
  theme_void() + 
  theme(legend.text=element_text(family="IBM Plex Mono",color="#32127a"),
        legend.title=element_text(family="IBM Plex Mono",color="#32127a"))

ggsave("congress_bookdown/figures/enviroLaborBigrams_wordPairs_corr_25yr_1950.jpg") #h=11,



#### 1975
enviroLaborBigrams_wordPairs_corr_25yr_1975 <- enviroLaborBigrams %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 25) %>%
  filter(period==1975) %>%
  group_by(term) %>%
  filter(n() >= 40) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(item1 %ilike% enviroLaborBigramVocabString_simple) %>%
  slice_max(correlation,n=85) %>%
  arrange(-correlation)

set.seed(2016)
enviroLaborBigrams_wordPairs_corr_25yr_1975 %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha=correlation), 
                 edge_color="#32127a",
                 show.legend=TRUE) +
  geom_node_point(color="blueviolet", size=3.5) +
  geom_node_text(aes(label=name), 
                 color="#32127a",
                 family="IBM Plex Mono",
                 size=3,
                 repel = TRUE) +
  theme_void() + 
  theme(legend.text=element_text(family="IBM Plex Mono",color="#32127a"),
        legend.title=element_text(family="IBM Plex Mono",color="#32127a"))

ggsave("congress_bookdown/figures/enviroLaborBigrams_wordPairs_corr_25yr_1975.jpg") #h=11,




#### 2000
enviroLaborBigrams_wordPairs_corr_25yr_2000 <- enviroLaborBigrams %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 25) %>%
  filter(period==2000) %>%
  group_by(term) %>%
  filter(n() >= 40) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(item1 %ilike% enviroLaborBigramVocabString_simple) %>%
  slice_max(correlation,n=85) %>%
  arrange(-correlation)

set.seed(2016)
enviroLaborBigrams_wordPairs_corr_25yr_2000 %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha=correlation), 
                 edge_color="#32127a",
                 show.legend=TRUE) +
  geom_node_point(color="blueviolet", size=3.5) +
  geom_node_text(aes(label=name), 
                 color="#32127a",
                 family="IBM Plex Mono",
                 size=3,
                 repel = TRUE) +
  theme_void() + 
  theme(legend.text=element_text(family="IBM Plex Mono",color="#32127a"),
        legend.title=element_text(family="IBM Plex Mono",color="#32127a"))

ggsave("congress_bookdown/figures/enviroLaborBigrams_wordPairs_corr_25yr_2000.jpg") #h=11,



```

##### 10-yr period:
```{r enviroLabor bigram co-occurence with enviroLabor per 10-yr period}


#### 1900
enviroLaborBigrams_wordPairs_corr_10yr_1900 <- enviroLaborBigrams %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 10) %>%
  filter(period==1900) %>%
  group_by(term) %>%
  filter(n() >= 10) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(item1 %ilike% enviroLaborBigramVocabString_simple) %>%
  slice_max(correlation,n=85) %>%
  arrange(-correlation)

set.seed(2016)
enviroLaborBigrams_wordPairs_corr_10yr_1900 %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha=correlation), 
                 edge_color="#32127a",
                 show.legend=TRUE) +
  geom_node_point(color="blueviolet", size=3.5) +
  geom_node_text(aes(label=name), 
                 color="#32127a",
                 family="IBM Plex Mono",
                 size=3,
                 repel = TRUE) +
  theme_void() + 
  theme(legend.text=element_text(family="IBM Plex Mono",color="#32127a"),
        legend.title=element_text(family="IBM Plex Mono",color="#32127a"))

ggsave("congress_bookdown/figures/enviroLaborBigrams_wordPairs_corr_10yr_1900.jpg") #h=11,



#### 1910
enviroLaborBigrams_wordPairs_corr_10yr_1910 <- enviroLaborBigrams %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 10) %>%
  filter(period==1910) %>%
  group_by(term) %>%
  filter(n() >= 10) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(item1 %ilike% enviroLaborBigramVocabString_simple) %>%
  slice_max(correlation,n=85) %>%
  arrange(-correlation)

set.seed(2016)
enviroLaborBigrams_wordPairs_corr_10yr_1910 %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha=correlation), 
                 edge_color="#32127a",
                 show.legend=TRUE) +
  geom_node_point(color="blueviolet", size=3.5) +
  geom_node_text(aes(label=name), 
                 color="#32127a",
                 family="IBM Plex Mono",
                 size=3,
                 repel = TRUE) +
  theme_void() + 
  theme(legend.text=element_text(family="IBM Plex Mono",color="#32127a"),
        legend.title=element_text(family="IBM Plex Mono",color="#32127a"))

ggsave("congress_bookdown/figures/enviroLaborBigrams_wordPairs_corr_10yr_1910.jpg") #h=11,



#### 1920
enviroLaborBigrams_wordPairs_corr_10yr_1920 <- enviroLaborBigrams %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 10) %>%
  filter(period==1920) %>%
  group_by(term) %>%
  filter(n() >= 10) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(item1 %ilike% enviroLaborBigramVocabString_simple) %>%
  slice_max(correlation,n=85) %>%
  arrange(-correlation)

set.seed(2016)
enviroLaborBigrams_wordPairs_corr_10yr_1920 %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha=correlation), 
                 edge_color="#32127a",
                 show.legend=TRUE) +
  geom_node_point(color="blueviolet", size=3.5) +
  geom_node_text(aes(label=name), 
                 color="#32127a",
                 family="IBM Plex Mono",
                 size=3,
                 repel = TRUE) +
  theme_void() + 
  theme(legend.text=element_text(family="IBM Plex Mono",color="#32127a"),
        legend.title=element_text(family="IBM Plex Mono",color="#32127a"))

ggsave("congress_bookdown/figures/enviroLaborBigrams_wordPairs_corr_10yr_1920.jpg") #h=11,



#### 1930
enviroLaborBigrams_wordPairs_corr_10yr_1930 <- enviroLaborBigrams %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 10) %>%
  filter(period==1930) %>%
  group_by(term) %>%
  filter(n() >= 10) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(item1 %ilike% enviroLaborBigramVocabString_simple) %>%
  slice_max(correlation,n=85) %>%
  arrange(-correlation)

set.seed(2016)
enviroLaborBigrams_wordPairs_corr_10yr_1930 %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha=correlation), 
                 edge_color="#32127a",
                 show.legend=TRUE) +
  geom_node_point(color="blueviolet", size=3.5) +
  geom_node_text(aes(label=name), 
                 color="#32127a",
                 family="IBM Plex Mono",
                 size=3,
                 repel = TRUE) +
  theme_void() + 
  theme(legend.text=element_text(family="IBM Plex Mono",color="#32127a"),
        legend.title=element_text(family="IBM Plex Mono",color="#32127a"))

ggsave("congress_bookdown/figures/enviroLaborBigrams_wordPairs_corr_10yr_1930.jpg") #h=11,



#### 1940
enviroLaborBigrams_wordPairs_corr_10yr_1940 <- enviroLaborBigrams %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 10) %>%
  filter(period==1940) %>%
  group_by(term) %>%
  filter(n() >= 10) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(item1 %ilike% enviroLaborBigramVocabString_simple) %>%
  slice_max(correlation,n=85) %>%
  arrange(-correlation)

set.seed(2016)
enviroLaborBigrams_wordPairs_corr_10yr_1940 %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha=correlation), 
                 edge_color="#32127a",
                 show.legend=TRUE) +
  geom_node_point(color="blueviolet", size=3.5) +
  geom_node_text(aes(label=name), 
                 color="#32127a",
                 family="IBM Plex Mono",
                 size=3,
                 repel = TRUE) +
  theme_void() + 
  theme(legend.text=element_text(family="IBM Plex Mono",color="#32127a"),
        legend.title=element_text(family="IBM Plex Mono",color="#32127a"))

ggsave("congress_bookdown/figures/enviroLaborBigrams_wordPairs_corr_10yr_1940.jpg") #h=11,



#### 1950
enviroLaborBigrams_wordPairs_corr_10yr_1950 <- enviroLaborBigrams %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 10) %>%
  filter(period==1950) %>%
  group_by(term) %>%
  filter(n() >= 10) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(item1 %ilike% enviroLaborBigramVocabString_simple) %>%
  slice_max(correlation,n=85) %>%
  arrange(-correlation)

set.seed(2016)
enviroLaborBigrams_wordPairs_corr_10yr_1950 %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha=correlation), 
                 edge_color="#32127a",
                 show.legend=TRUE) +
  geom_node_point(color="blueviolet", size=3.5) +
  geom_node_text(aes(label=name), 
                 color="#32127a",
                 family="IBM Plex Mono",
                 size=3,
                 repel = TRUE) +
  theme_void() + 
  theme(legend.text=element_text(family="IBM Plex Mono",color="#32127a"),
        legend.title=element_text(family="IBM Plex Mono",color="#32127a"))

ggsave("congress_bookdown/figures/enviroLaborBigrams_wordPairs_corr_10yr_1950.jpg") #h=11,




#### 1960
enviroLaborBigrams_wordPairs_corr_10yr_1960 <- enviroLaborBigrams %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 10) %>%
  filter(period==1960) %>%
  group_by(term) %>%
  filter(n() >= 20) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(item1 %ilike% enviroLaborBigramVocabString_simple) %>%
  slice_max(correlation,n=85) %>%
  arrange(-correlation)

set.seed(2016)
enviroLaborBigrams_wordPairs_corr_10yr_1960 %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha=correlation), 
                 edge_color="#32127a",
                 show.legend=TRUE) +
  geom_node_point(color="blueviolet", size=3.5) +
  geom_node_text(aes(label=name), 
                 color="#32127a",
                 family="IBM Plex Mono",
                 size=3,
                 repel = TRUE) +
  theme_void() + 
  theme(legend.text=element_text(family="IBM Plex Mono",color="#32127a"),
        legend.title=element_text(family="IBM Plex Mono",color="#32127a"))

ggsave("congress_bookdown/figures/enviroLaborBigrams_wordPairs_corr_10yr_1960.jpg") #h=11,




#### 1970
enviroLaborBigrams_wordPairs_corr_10yr_1970 <- enviroLaborBigrams %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 10) %>%
  filter(period==1970) %>%
  group_by(term) %>%
  filter(n() >= 20) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(item1 %ilike% enviroLaborBigramVocabString_simple) %>%
  slice_max(correlation,n=85) %>%
  arrange(-correlation)

set.seed(2016)
enviroLaborBigrams_wordPairs_corr_10yr_1970 %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha=correlation), 
                 edge_color="#32127a",
                 show.legend=TRUE) +
  geom_node_point(color="blueviolet", size=3.5) +
  geom_node_text(aes(label=name), 
                 color="#32127a",
                 family="IBM Plex Mono",
                 size=3,
                 repel = TRUE) +
  theme_void() + 
  theme(legend.text=element_text(family="IBM Plex Mono",color="#32127a"),
        legend.title=element_text(family="IBM Plex Mono",color="#32127a"))

ggsave("congress_bookdown/figures/enviroLaborBigrams_wordPairs_corr_10yr_1970.jpg") #h=11,



#### 1980
enviroLaborBigrams_wordPairs_corr_10yr_1980 <- enviroLaborBigrams %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 10) %>%
  filter(period==1980) %>%
  group_by(term) %>%
  filter(n() >= 20) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(item1 %ilike% enviroLaborBigramVocabString_simple) %>%
  slice_max(correlation,n=85) %>%
  arrange(-correlation)

set.seed(2016)
enviroLaborBigrams_wordPairs_corr_10yr_1980 %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha=correlation), 
                 edge_color="#32127a",
                 show.legend=TRUE) +
  geom_node_point(color="blueviolet", size=3.5) +
  geom_node_text(aes(label=name), 
                 color="#32127a",
                 family="IBM Plex Mono",
                 size=3,
                 repel = TRUE) +
  theme_void() + 
  theme(legend.text=element_text(family="IBM Plex Mono",color="#32127a"),
        legend.title=element_text(family="IBM Plex Mono",color="#32127a"))

ggsave("congress_bookdown/figures/enviroLaborBigrams_wordPairs_corr_10yr_1980.jpg") #h=11,




#### 1990
enviroLaborBigrams_wordPairs_corr_10yr_1990 <- enviroLaborBigrams %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 10) %>%
  filter(period==1990) %>%
  group_by(term) %>%
  filter(n() >= 20) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(item1 %ilike% enviroLaborBigramVocabString_simple) %>%
  slice_max(correlation,n=85) %>%
  arrange(-correlation)

set.seed(2016)
enviroLaborBigrams_wordPairs_corr_10yr_1990 %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha=correlation), 
                 edge_color="#32127a",
                 show.legend=TRUE) +
  geom_node_point(color="blueviolet", size=3.5) +
  geom_node_text(aes(label=name), 
                 color="#32127a",
                 family="IBM Plex Mono",
                 size=3,
                 repel = TRUE) +
  theme_void() + 
  theme(legend.text=element_text(family="IBM Plex Mono",color="#32127a"),
        legend.title=element_text(family="IBM Plex Mono",color="#32127a"))

ggsave("congress_bookdown/figures/enviroLaborBigrams_wordPairs_corr_10yr_1990.jpg") #h=11,



#### 2000
enviroLaborBigrams_wordPairs_corr_10yr_2000 <- enviroLaborBigrams %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 10) %>%
  filter(period==2000) %>%
  group_by(term) %>%
  filter(n() >= 20) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(item1 %ilike% enviroLaborBigramVocabString_simple) %>%
  slice_max(correlation,n=85) %>%
  arrange(-correlation)

set.seed(2016)
enviroLaborBigrams_wordPairs_corr_10yr_2000 %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha=correlation), 
                 edge_color="#32127a",
                 show.legend=TRUE) +
  geom_node_point(color="blueviolet", size=3.5) +
  geom_node_text(aes(label=name), 
                 color="#32127a",
                 family="IBM Plex Mono",
                 size=3,
                 repel = TRUE) +
  theme_void() + 
  theme(legend.text=element_text(family="IBM Plex Mono",color="#32127a"),
        legend.title=element_text(family="IBM Plex Mono",color="#32127a"))

ggsave("congress_bookdown/figures/enviroLaborBigrams_wordPairs_corr_10yr_2000.jpg") #h=11,



#### 2010
enviroLaborBigrams_wordPairs_corr_10yr_2010 <- enviroLaborBigrams %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 10) %>%
  filter(period==2010) %>%
  group_by(term) %>%
  filter(n() >= 20) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(item1 %ilike% enviroLaborBigramVocabString_simple) %>%
  slice_max(correlation,n=85) %>%
  arrange(-correlation)

set.seed(2016)
enviroLaborBigrams_wordPairs_corr_10yr_2010 %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha=correlation), 
                 edge_color="#32127a",
                 show.legend=TRUE) +
  geom_node_point(color="blueviolet", size=3.5) +
  geom_node_text(aes(label=name), 
                 color="#32127a",
                 family="IBM Plex Mono",
                 size=3,
                 repel = TRUE) +
  theme_void() + 
  theme(legend.text=element_text(family="IBM Plex Mono",color="#32127a"),
        legend.title=element_text(family="IBM Plex Mono",color="#32127a"))

ggsave("congress_bookdown/figures/enviroLaborBigrams_wordPairs_corr_10yr_2010.jpg") #h=11,



#### 2020
enviroLaborBigrams_wordPairs_corr_10yr_2020 <- enviroLaborBigrams %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 10) %>%
  filter(period==2020) %>%
  group_by(term) %>%
  filter(n() >= 10) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(item1 %ilike% enviroLaborBigramVocabString_simple) %>%
  slice_max(correlation,n=85) %>%
  arrange(-correlation)

set.seed(2016)
enviroLaborBigrams_wordPairs_corr_10yr_2020 %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha=correlation), 
                 edge_color="#32127a",
                 show.legend=TRUE) +
  geom_node_point(color="blueviolet", size=3.5) +
  geom_node_text(aes(label=name), 
                 color="#32127a",
                 family="IBM Plex Mono",
                 size=3,
                 repel = TRUE) +
  theme_void() + 
  theme(legend.text=element_text(family="IBM Plex Mono",color="#32127a"),
        legend.title=element_text(family="IBM Plex Mono",color="#32127a"))

ggsave("congress_bookdown/figures/enviroLaborBigrams_wordPairs_corr_10yr_2020.jpg") #h=11,


```


## TOPIC MODELING


