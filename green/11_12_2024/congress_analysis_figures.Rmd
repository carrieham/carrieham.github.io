---
title: "CLC text mining"
output:
  html_document:
    pandoc_args:
    - +RTS
    - "-M64G"
    - "-RTS"
    code_folding: hide
    self_contained: no
    df_print: paged
    highlighter: haddock
    toc: true
    toc_float: true
    css: styles.css
    includes:
      in_header: header.html
---
<p>

<center><font size="3">`r Sys.Date()`</font></center>

</p>

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE, warning = FALSE)
#quanteda_options(tokens_block_size = 50000)

options(repos = list(CRAN="http://cran.rstudio.com/"))
install.packages("pacman")
library(pacman)

p_load(bookdown,
       data.table,
       DataTables,
       dplyr, 
       DT,
       forcats,
       ggrepel,
       htmlwidgets,
       lubridate,
       plotly,
       quanteda,
       stopwords,
       tictoc,
       tidyverse, 
       tidytext,
       tokenizers,
       vroom,
       widyr,
       ggraph,
       igraph,
       topicmodels)

# library(reticulate)
# require(devtools)
# install_github("stephbuon/posextractr")
# library(posextractr)
# # posextract_install() #only run first time ever installing package
# # virtualenv_create("r-posextract", python="3.12")
# py_install(c("pandas", "spacy", "posextract","lark"), pip = TRUE)
# # system(command = "python3 -m spacy download en_core_web_sm")
# posextract_initialize()

```

### DATA
```{r input data, include=FALSE, cache=TRUE, cache.lazy=FALSE}

load(verbose=TRUE,"data/enviroLaborSpeeches.Rda")

enviroLaborSpeeches <- enviroLaborSpeeches %>%
  filter(year>=1960)

stopwords_iso <- stopwords("en", source = "stopwords-iso") 
stopwords_manual <- c("absent","adjourn", "ask", "can", "chairman",
                       "committee","con","democrat","etc","gentleladies",
                       "gentlelady", "gentleman", "gentlemen", "gentlewoman",
                       "gentlewomen","hereabout","hereafter","hereat", "hereby",
                       "herein", "hereinafter", "hereinbefore", "hereinto", "hereof",
                       "hereon", "hereto", "heretofore", "hereunder", "hereunto",
                       "hereupon", "herewith", "month", "mr", "mrs", "nai", "nay",
                       "none", "now", "part", "per", "pro", "republican",
                       "say", "senator", "shall", "sir", "speak", "speaker",
                       "tell", "thank", "thereabout", "thereafter", "thereagainst",
                       "thereat", "therebefore", "therebeforn", "thereby", "therefor",
                       "therefore", "therefrom", "therein", "thereinafter", "thereof",
                       "thereon", "thereto", "theretofore", "thereunder", "thereunto",
                       "thereupon", "therewith", "therewithal", "today", "whereabouts",
                       "whereafter", "whereas", "whereat", "whereby","wherefore",
                       "wherefrom", "wherein", "whereinto", "whereof", "whereon","whereto",
                       "whereunder", "whereupon", "wherever", "wherewith", 
                       "wherewithal", "will", "yea", "yes", "yield")

stopwords_manual2 <- c("white house","white houses",
                       "avenue","street","nw","northwest","suite",
                       "number","numeric","sequence","sequences",
                       "add","addition","additions","adding","added",
                       "amend","amended","amendment","amendments","amending","amends",
                       "america","american","americas",
                       "bill","bills",
                       "chapter","chapters",
                       "code","codes",
                       "country","countrys", 
                       "congress","congressional",
                       "district of columbia","district","districts",
                       "enact","enacted","enacting","enacts",
                       "federal", 
                       "senate","senates", 
                       "house of representatives","representative","representatives","the house",
                       "insert","inserting","inserted","inserts",
                       "law","laws",
                       "legislation","legislative","legislator",
                       "paragraph","paragraphs","sentence","sentences",
                       "percent","percentage","percentages",
                       "president","presidents","presidential", 
                       "print","printing","printed","prints",
                       "record","recording","recorded","records",
                       "section","sections",
                       "united states",
                       "state","states",
                       "subchapter","subchapters",
                       "subsection","subsections",
                       "supreme court","supreme courts","court","courts",
                       "title","titles",
                       "unanimous consent","consent","consenting",
                       "united","u.s.","us",
                       "urge","urging","urged","urges",
                       "colleague","colleagues",
                       "washington", "d.c.")

stopwords <- c(stopwords_manual2,stopwords_manual,stopwords_iso)

bad_syntax <- vroom("data/vocabulary/master_list.txt",delim="|") %>%
  rename("classify" = "_classify") %>%
  filter(classify != "vocab") %>%
  mutate(phrase=str_replace_all(phrase," ","_"))

bad_syntax_manual <- c("llc_york",
                       "york_trump",
                       "remain_expend",
                       "corp_york",
                       "dt_mark",
                       "llc_trump",
                       "subparagraph_strike",
                       "unoblig_balanc",
                       "include_transfer",
                       "fiscal_fiscal",
                       "pre_submiss",
                       "preced_divis",
                       "preced_proviso",
                       "corp_trump",
                       "york_dt",
                       "dt_mark",
                       "manag_corp",
                       "hous_dc",
                       "dc_hon")

```

```{r input tokens data, include=FALSE, cache=TRUE, cache.lazy=FALSE}

load(verbose=TRUE,"data/R/enviroTokens.Rda")

load(verbose=TRUE,"data/R/enviroBigrams.Rda")

load(verbose=TRUE,"data/R/laborTokens.Rda")

load(verbose=TRUE,"data/R/laborBigrams.Rda")

load(verbose=TRUE,"data/R/enviroLaborTokens.Rda")

load(verbose=TRUE,"data/R/enviroLaborBigrams.Rda")
```

```{r enviro bigrams , message=FALSE, results=FALSE, cache=TRUE, lazy.cache=FALSE}

# ##### BIGRAMS #####
tic()
enviroBigrams <- enviroLaborSpeeches %>%
  filter(environment=="Yes") %>%
  corpus(docid_field="speech_id",
         text_field="speech") %>%
  tokenize_word_stems(stopwords=stopwords) %>%
  tokens(remove_punct=FALSE, #CREATE TOKEN OBJECT
         split_tags=TRUE,
         split_elisions=TRUE,
         remove_symbols=TRUE,
         remove_numbers=TRUE,
         remove_separators=TRUE,
         padding=FALSE,
         xptr=TRUE,
         verbose=TRUE) %>%
  tokens_remove("\\p{P}", valuetype = "regex", #REMOVE PUNCT
                padding=TRUE, #REPLACE W/ EMPTY STRINGS
                verbose=TRUE) %>%
  # tokens_remove(stopwords, #REMOVE STOP WORDS BEFORE TRIPLES CREATED
  #               padding=FALSE,
  #               verbose=TRUE) %>%
  tokens_ngrams(n=2) %>% #CREATE BIGRAMS
  dfm() %>% #CREATE DOC-TERM MATRIX
  tidy() %>%
  filter(!(term %in% bad_syntax$phrase)) %>%
  filter(!(term %in% bad_syntax_manual)) %>%
  mutate(speech_id=as.double(document)) %>%
  left_join(enviroLaborSpeeches %>% select(year,date,speech_id,environment,labor),by=join_by(speech_id==speech_id)) %>%
  as_tibble()

toc()
#
# ##### SAVE FILE
save(enviroBigrams,file="data/R/enviroBigrams.Rda")

```

```{r labor bigrams , message=FALSE, results=FALSE, cache=TRUE, lazy.cache=FALSE}

##### BIGRAMS #####
tic()
laborBigrams <- enviroLaborSpeeches %>%
  filter(labor=="Yes") %>%
  corpus(docid_field="speech_id",
         text_field="speech") %>%
  tokenize_word_stems(stopwords=stopwords) %>%
  tokens(remove_punct=FALSE, #CREATE TOKEN OBJECT
         split_tags=TRUE,
         split_elisions=TRUE,
         remove_symbols=TRUE,
         remove_numbers=TRUE,
         remove_separators=TRUE,
         padding=FALSE,
         xptr=TRUE,
         verbose=TRUE) %>%
  # tokens_remove(stopwords, #REMOVE STOP WORDS BEFORE TRIPLES CREATED
  #               padding=FALSE,
  #               verbose=TRUE) %>%
  tokens_remove("\\p{P}", valuetype = "regex", #REMOVE PUNCT
                padding=TRUE, #REPLACE W/ EMPTY STRINGS
                verbose=TRUE) %>%
  tokens_ngrams(n=2) %>% #CREATE BIGRAMS
  dfm() %>% #CREATE DOC-TERM MATRIX
  tidy() %>%
  filter(!(term %in% bad_syntax$phrase)) %>%
  filter(!(term %in% bad_syntax_manual)) %>%
  mutate(speech_id=as.double(document)) %>%
  left_join(enviroLaborSpeeches %>% select(year,date,speech_id,environment,labor),by=join_by(speech_id==speech_id)) %>%
  as_tibble()
toc()

##### SAVE FILE
save(laborBigrams,file="data/R/laborBigrams.Rda")

```

```{r enviroLabor bigrams , message=FALSE, results=FALSE, cache=TRUE, lazy.cache=FALSE}

##### BIGRAMS #####
tic()
enviroLaborBigrams <- enviroLaborSpeeches %>%
  filter(environment=="Yes" & labor=="Yes") %>%
  corpus(docid_field="speech_id",
         text_field="speech") %>%
  tokenize_word_stems(stopwords=stopwords) %>%
  tokens(remove_punct=FALSE, #CREATE TOKEN OBJECT
         split_tags=TRUE,
         split_elisions=TRUE,
         remove_symbols=TRUE,
         remove_numbers=TRUE,
         remove_separators=TRUE,
         padding=FALSE,
         xptr=TRUE,
         verbose=TRUE) %>%
  # tokens_remove(stopwords, #REMOVE STOP WORDS BEFORE TRIPLES CREATED
  #               padding=FALSE,
  #               verbose=TRUE) %>%
  tokens_remove("\\p{P}", valuetype = "regex", #REMOVE PUNCT
                padding=TRUE, #REPLACE W/ EMPTY STRINGS
                verbose=TRUE) %>%
  tokens_ngrams(n=2) %>% #CREATE BIGRAMS
  dfm() %>% #CREATE DOC-TERM MATRIX
  tidy() %>%
  filter(!(term %in% bad_syntax$phrase)) %>%
  filter(!(term %in% bad_syntax_manual)) %>%
  mutate(speech_id=as.double(document)) %>%
  left_join(enviroLaborSpeeches %>% select(year,date,speech_id,environment,labor),by=join_by(speech_id==speech_id)) %>%
  as_tibble()
toc()

##### SAVE FILE
save(enviroLaborBigrams,file="data/R/enviroLaborBigrams.Rda")

enviroLaborBigrams_1965 <- enviroLaborBigrams %>%
  filter(year>=1965)
```

```{r enviro tokens, message=FALSE, results=FALSE, cache=TRUE, lazy.cache=FALSE}

##### TOKENS #####
tic()
enviroTokens <- enviroLaborSpeeches %>%
  filter(environment=="Yes") %>%
  corpus(docid_field="speech_id",
         text_field="speech") %>%
  tokenize_word_stems(stopwords=stopwords) %>%
  tokens(remove_punct=TRUE, #CREATE TOKEN OBJECT
         split_tags=TRUE,
         split_elisions=TRUE,
         remove_symbols=TRUE,
         remove_numbers=TRUE,
         remove_separators=TRUE,
         padding=FALSE,
         xptr=TRUE,
         verbose=TRUE) %>%
  dfm() %>% #CREATE DOC-TERM MATRIX
  tidy() %>%
  mutate(speech_id=as.double(document)) %>%
  left_join(enviroLaborSpeeches %>% select(year,date,speech_id,environment,labor),by=join_by(speech_id==speech_id)) %>%
  as_tibble()
toc()

##### SAVE FILE
save(enviroTokens,file="data/R/enviroTokens.Rda")

```

```{r labor tokens, message=FALSE, results=FALSE, cache=TRUE, lazy.cache=FALSE}

##### TOKENS #####
tic()
laborTokens <- enviroLaborSpeeches %>%
  filter(labor=="Yes") %>%
  corpus(docid_field="speech_id",
         text_field="speech") %>%
  tokenize_word_stems(stopwords=stopwords) %>%
  tokens(remove_punct=TRUE, #CREATE TOKEN OBJECT
         split_tags=TRUE,
         split_elisions=TRUE,
         remove_symbols=TRUE,
         remove_numbers=TRUE,
         remove_separators=TRUE,
         padding=FALSE,
         xptr=TRUE,
         verbose=TRUE) %>%
  dfm() %>% #CREATE DOC-TERM MATRIX
  tidy() %>%
  mutate(speech_id=as.double(document)) %>%
  left_join(enviroLaborSpeeches %>% select(year,date,speech_id,environment,labor),by=join_by(speech_id==speech_id)) %>%
  as_tibble()
toc()

##### SAVE FILE
save(laborTokens,file="data/R/laborTokens.Rda")
```

```{r enviroLabor tokens, message=FALSE, results=FALSE, cache=TRUE, lazy.cache=FALSE}

##### TOKENS #####
tic()
enviroLaborTokens <- enviroLaborSpeeches %>%
  filter(environment=="Yes" & labor=="Yes") %>%
  corpus(docid_field="speech_id",
         text_field="speech") %>%
  tokenize_word_stems(stopwords=stopwords) %>%
  tokens(remove_punct=TRUE, #CREATE TOKEN OBJECT
         split_tags=TRUE,
         split_elisions=TRUE,
         remove_symbols=TRUE,
         remove_numbers=TRUE,
         remove_separators=TRUE,
         padding=FALSE,
         xptr=TRUE,
         verbose=TRUE) %>%
  dfm() %>% #CREATE DOC-TERM MATRIX
  tidy() %>%
  mutate(speech_id=as.double(document)) %>%
  left_join(enviroLaborSpeeches %>% select(year,date,speech_id,environment,labor),by=join_by(speech_id==speech_id)) %>%
  as_tibble()
toc()

##### SAVE FILE
save(enviroLaborTokens,file="data/R/enviroLaborTokens.Rda")

```

### SPEECHES
```{r enviroLabor speeches over time , echo=FALSE, cache=TRUE}

enviroSpeeches_byYear <- enviroLaborSpeeches %>%
  filter(environment=="Yes") %>%
  group_by(year) %>%
  summarize(n=n(),prop=n/unique(total_annual_speeches)) %>%
  arrange(desc(year))

laborSpeeches_byYear <- enviroLaborSpeeches %>%
  filter(labor=="Yes") %>%
  group_by(year) %>%
  summarize(n=n(),prop=n/unique(total_annual_speeches)) %>%
  arrange(desc(year))

enviroLaborSpeeches_byYear <- enviroLaborSpeeches %>%
  filter(environment=="Yes" & labor=="Yes") %>%
  group_by(year) %>%
  summarize(n=n(),prop=n/unique(total_annual_speeches)) %>%
  arrange(desc(year))

allSpeeches_byYear <- rbind(mutate(enviroSpeeches_byYear,type="environment"),
                            mutate(laborSpeeches_byYear,type="labor"),
                            mutate(enviroLaborSpeeches_byYear,type="enviro-labor"))

map_allSpeeches_byYear <- ggplot() +
geom_line(data=allSpeeches_byYear,
              aes(x=year,
                  y=n,
                  group=3,
                  color=type,
                  text=paste("<b>",year,":</b> ",n," speeches",sep=""))) +
  scale_color_manual(values=c("environment"="aquamarine4",
                              "labor"="blueviolet",
                              "enviro-labor"="plum4")) +
  guides(color=guide_legend(title = "")) +
  scale_x_continuous(breaks = seq(1880, 2020, by = 10)) + 
  theme_minimal() +
  theme(axis.line=element_line(color="#32127a"),
        axis.ticks=element_line(color="#32127a"),
        axis.title.x=element_blank(),
        axis.title.y=element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank())

##### make interactive
ggplotly(map_allSpeeches_byYear, tooltip="text") %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         legend=list(xref="paper",
                     x=0.5,xanchor='center',
                     y=1,yanchor='top',
                     orientation='h',
                     traceorder="reversed",
                     title=list(font=list(color="#32127a",family="IBM Plex Mono")),
                     font=list(color="#32127a",family="IBM Plex Mono"))) %>%
  partial_bundle() %>%
  saveWidget("figures/speeches_by_year.html", selfcontained = F, libdir = "lib")

```

```{r enviroLabor prop speeches over time, echo=FALSE, cache=TRUE}

map_allSpeeches_prop_byYear <- ggplot() +
geom_line(data=allSpeeches_byYear,
              aes(x=year,
                  y=prop,
                  group=3,
                  color=type,
                  text=paste("<b>",year,":</b> ",round(prop*100,1),"% of speeches",sep=""))) +
  scale_color_manual(values=c("environment"="aquamarine4",
                              "labor"="blueviolet",
                              "enviro-labor"="plum4")) +
  guides(color=guide_legend(title = "")) +
  scale_x_continuous(breaks = seq(1880, 2020, by = 10)) + 
  theme_minimal() +
  theme(axis.line=element_line(color="#32127a"),
        axis.ticks=element_line(color="#32127a"),
        axis.title.x=element_blank(),
        axis.title.y=element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank())

##### make interactive
ggplotly(map_allSpeeches_prop_byYear, tooltip="text") %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         legend=list(xref="paper",
                     x=0.5,xanchor='center',
                     y=1,yanchor='top',
                     orientation='h',
                     traceorder="reversed",
                     title=list(font=list(color="#32127a",family="IBM Plex Mono")),
                     font=list(color="#32127a",family="IBM Plex Mono"))) %>%
  partial_bundle() %>%
  saveWidget("figures/speeches_prop_by_year.html", selfcontained = F, libdir = "lib")

```

### ANALYSIS: BIGRAM COUNTS

#### ENVIRO

##### top 25 enviro bigrams
```{r enviro bigram counts, message=FALSE, cache=FALSE, cache.lazy = FALSE}

enviroBigrams_top25 <- enviroBigrams %>%
  as_tibble() %>%
  count(term,wt=count) %>%
  top_n(25) %>%
  arrange(desc(n))
save(enviroBigrams_top25,file="data/R/tables/enviroBigrams_top25.Rda")

# load(verbose=TRUE,file="data/R/tables/enviroBigrams_top25.Rda")

map_enviroBigrams_top25 <- ggplot() +
    geom_col(data=enviroBigrams_top25,
             aes(x=fct_reorder(term,n),
                 y=n,
                 text=paste("<b>",term,":</b> ",n,sep="")),
             fill="aquamarine4") +
  coord_flip() +
  theme_minimal() +
  theme(axis.line=element_line(color="#32127a"),
        axis.ticks=element_line(color="#32127a"),
        axis.title.x=element_blank(),
        axis.title.y=element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank())



##### make interactive
ggplotly(map_enviroBigrams_top25, tooltip="text") %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  partial_bundle() %>%
  saveWidget("figures/enviro_bigrams_top25.html", selfcontained = F, libdir = "lib")

```

##### top 20 enviro bigrams per 20-year period (since 1960)
```{r top enviro bigrams by year 20-yr period, message=FALSE, cache=TRUE}

enviro_bigrams_by_year_20yr <- enviroBigrams %>%
  filter(year>=1960 & year<=2019) %>%
  filter(!(term %in% bad_syntax$phrase)) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 20) %>%
  group_by(period) %>%
  count(term,wt=count) %>%
  top_n(20) %>%
  arrange(desc(n))
save(enviro_bigrams_by_year_20yr,file="data/R/tables/enviroBigrams_by_20yrs.Rda")


#### 1960
top_enviroBigrams_20yr_1960 <- ggplot() +
  geom_col(data=filter(enviro_bigrams_by_year_20yr,period==1960),
           aes(x=reorder_within(term,n,period),y=n),
               fill="aquamarine4") +
  coord_flip() +
  scale_x_reordered() +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(title="1960",x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroBigrams_20yr_1960, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("figures/top_enviroBigrams_20yr_1960.html",selfcontained = F, libdir = "lib")


#### 1980
top_enviroBigrams_20yr_1980 <- ggplot() +
  geom_col(data=filter(enviro_bigrams_by_year_20yr,period==1980),
           aes(x=reorder_within(term,n,period),y=n),
               fill="aquamarine4") +
  coord_flip() +
  scale_x_reordered() +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(title="1980",x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroBigrams_20yr_1980, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("figures/top_enviroBigrams_20yr_1980.html",selfcontained = F, libdir = "lib")


#### 2000
top_enviroBigrams_20yr_2000 <- ggplot() +
  geom_col(data=filter(enviro_bigrams_by_year_20yr,period==2000),
           aes(x=reorder_within(term,n,period),y=n),
               fill="aquamarine4") +
  coord_flip() +
  scale_x_reordered() +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(title="2000",x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroBigrams_20yr_2000, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("figures/top_enviroBigrams_20yr_2000.html",selfcontained = F, libdir = "lib")



```

##### top 20 enviro bigrams per 15-year period (since 1965)
```{r top enviro bigrams by year 15-yr period, message=FALSE, cache=TRUE}

enviro_bigrams_by_year_15yr <- enviroBigrams %>%
  filter(year>=1965) %>%
  filter(!(term %in% bad_syntax$phrase)) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 15) %>%
  group_by(period) %>%
  count(term,wt=count) %>%
  top_n(20) %>%
  arrange(desc(n))
save(enviro_bigrams_by_year_15yr,file="data/R/tables/enviroBigrams_by_15yrs.Rda")
  

#### 1965 & 1980
top_enviroBigrams_15yr_1965_1980 <- ggplot() +
  geom_col(data=filter(enviro_bigrams_by_year_15yr,period==1965 | period==1980),
           aes(x=reorder_within(term,n,period),y=n),
               fill="aquamarine4") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroBigrams_15yr_1965_1980, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("figures/top_enviroBigrams_15yr_1965_1980.html",selfcontained = F, libdir = "lib")


#### 1995 & 2010
top_enviroBigrams_15yr_1995_2010 <- ggplot() +
  geom_col(data=filter(enviro_bigrams_by_year_15yr,period==1995 | period==2010),
           aes(x=reorder_within(term,n,period),y=n),
               fill="aquamarine4") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroBigrams_15yr_1995_2010, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("figures/top_enviroBigrams_15yr_1995_2010.html",selfcontained = F, libdir = "lib")

```

##### top 20 enviro bigrams per 5-year period (since 1965)
```{r top enviro bigrams by year 5-yr period, message=FALSE, cache=TRUE}

enviro_bigrams_by_year_5yr <- enviroBigrams %>%
  filter(year>=1965) %>%
  filter(!(term %in% bad_syntax$phrase)) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 5) %>%
  group_by(period) %>%
  count(term,wt=count) %>%
  top_n(20) %>%
  arrange(desc(n))
save(enviro_bigrams_by_year_5yr,file="data/R/tables/enviroBigrams_by_5yrs.Rda")


#### 1965 & 1970
top_enviroBigrams_5yr_1965_1970 <- ggplot() +
  geom_col(data=filter(enviro_bigrams_by_year_5yr,period==1965 | period==1970),
           aes(x=reorder_within(term,n,period),y=n),
               fill="aquamarine4") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroBigrams_5yr_1965_1970, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("figures/top_enviroBigrams_5yr_1965_1970.html",selfcontained = F, libdir = "lib")


#### 1975 & 1980
top_enviroBigrams_5yr_1975_1980 <- ggplot() +
  geom_col(data=filter(enviro_bigrams_by_year_5yr,period==1975 | period==1980),
           aes(x=reorder_within(term,n,period),y=n),
               fill="aquamarine4") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroBigrams_5yr_1975_1980, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("figures/top_enviroBigrams_5yr_1975_1980.html",selfcontained = F, libdir = "lib")


#### 1985 & 1990
top_enviroBigrams_5yr_1985_1990 <- ggplot() +
  geom_col(data=filter(enviro_bigrams_by_year_5yr,period==1985 | period==1990),
           aes(x=reorder_within(term,n,period),y=n),
               fill="aquamarine4") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroBigrams_5yr_1985_1990, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("figures/top_enviroBigrams_5yr_1985_1990.html",selfcontained = F, libdir = "lib")


#### 1995 & 2000
top_enviroBigrams_5yr_1995_2000 <- ggplot() +
  geom_col(data=filter(enviro_bigrams_by_year_5yr,period==1995 | period==2000),
           aes(x=reorder_within(term,n,period),y=n),
               fill="aquamarine4") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroBigrams_5yr_1995_2000, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("figures/top_enviroBigrams_5yr_1995_2000.html",selfcontained = F, libdir = "lib")


#### 2005 & 2010
top_enviroBigrams_5yr_2005_2010 <- ggplot() +
  geom_col(data=filter(enviro_bigrams_by_year_5yr,period==2005 | period==2010),
           aes(x=reorder_within(term,n,period),y=n),
               fill="aquamarine4") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroBigrams_5yr_2005_2010, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("figures/top_enviroBigrams_5yr_2005_2010.html",selfcontained = F, libdir = "lib")

#### 2015 & 2020
top_enviroBigrams_5yr_2015_2020 <- ggplot() +
  geom_col(data=filter(enviro_bigrams_by_year_5yr,period==2015 | period==2020),
           aes(x=reorder_within(term,n,period),y=n),
               fill="aquamarine4") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroBigrams_5yr_2015_2020, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("figures/top_enviroBigrams_5yr_2015_2020.html",selfcontained = F, libdir = "lib")

```


#### LABOR

##### top 25 labor bigrams
```{r labor bigram counts, echo=FALSE, cache=FALSE, cache.lazy = FALSE}
laborBigrams_top25 <- laborBigrams %>%
  as_tibble() %>%
  count(term,wt=count) %>%
  top_n(25) %>%
  arrange(desc(n))
save(laborBigrams_top25,file="data/R/tables/laborBigrams_top25.Rda")

# load(verbose=TRUE,file="data/R/tables/laborBigrams_top25.Rda")

map_laborBigrams_top25 <- ggplot() +
    geom_col(data=laborBigrams_top25,
             aes(x=fct_reorder(term,n),
                 y=n,
                 text=paste("<b>",term,":</b> ",n,sep="")),
             #color="blueviolet",
             fill="blueviolet") +
  coord_flip() +
  theme_minimal() +
  theme(axis.line=element_line(color="#32127a"),
        axis.ticks=element_line(color="#32127a"),
        axis.title.x=element_blank(),
        axis.title.y=element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank())


##### make interactive
ggplotly(map_laborBigrams_top25, tooltip="text") %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  partial_bundle() %>%
  saveWidget("figures/labor_bigrams_top25.html", selfcontained = F, libdir = "lib")
```

##### top 20 labor bigrams per 20-year period (since 1960)
```{r top labor bigrams by year 20-yr period, message=FALSE, cache=TRUE}

labor_bigrams_by_year_20yr <- laborBigrams %>%
  filter(year>=1960 & year<=2019) %>%
  filter(!(term %in% bad_syntax$phrase)) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 20) %>%
  group_by(period) %>%
  count(term,wt=count) %>%
  top_n(20) %>%
  arrange(desc(n))
save(labor_bigrams_by_year_20yr,file="data/R/tables/laborBigrams_by_20yrs.Rda")


#### 1960
top_laborBigrams_20yr_1960 <- ggplot() +
  geom_col(data=filter(labor_bigrams_by_year_20yr,period==1960),
           aes(x=reorder_within(term,n,period),y=n),
               fill="blueviolet") +
  coord_flip() +
  scale_x_reordered() +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(title="1960",x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_laborBigrams_20yr_1960, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("figures/top_laborBigrams_20yr_1960.html",selfcontained = F, libdir = "lib")


#### 1980
top_laborBigrams_20yr_1980 <- ggplot() +
  geom_col(data=filter(labor_bigrams_by_year_20yr,period==1980),
           aes(x=reorder_within(term,n,period),y=n),
               fill="blueviolet") +
  coord_flip() +
  scale_x_reordered() +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(title="1980",x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_laborBigrams_20yr_1980, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("figures/top_laborBigrams_20yr_1980.html",selfcontained = F, libdir = "lib")


#### 2000
top_laborBigrams_20yr_2000 <- ggplot() +
  geom_col(data=filter(labor_bigrams_by_year_20yr,period==2000),
           aes(x=reorder_within(term,n,period),y=n),
               fill="blueviolet") +
  coord_flip() +
  scale_x_reordered() +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(title="2000",x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_laborBigrams_20yr_2000, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("figures/top_laborBigrams_20yr_2000.html",selfcontained = F, libdir = "lib")



```

##### top 20 labor bigrams per 15-year period (since 1965)
```{r top labor bigrams by year 10-yr period, message=FALSE, cache=TRUE}

labor_bigrams_by_year_15yr <- laborBigrams %>%
  filter(year>=1965) %>%
  filter(!(term %in% bad_syntax$phrase)) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 15) %>%
  group_by(period) %>%
  count(term,wt=count) %>%
  top_n(20) %>%
  arrange(desc(n))
save(labor_bigrams_by_year_15yr,file="data/R/tables/laborBigrams_by_15yrs.Rda")
  

#### 1965 & 1980
top_laborBigrams_15yr_1965_1980 <- ggplot() +
  geom_col(data=filter(labor_bigrams_by_year_15yr,period==1965 | period==1980),
           aes(x=reorder_within(term,n,period),y=n),
               fill="blueviolet") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_laborBigrams_15yr_1965_1980, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("figures/top_laborBigrams_15yr_1965_1980.html",selfcontained = F, libdir = "lib")


#### 1995 & 2010
top_laborBigrams_15yr_1995_2010 <- ggplot() +
  geom_col(data=filter(labor_bigrams_by_year_15yr,period==1995 | period==2010),
           aes(x=reorder_within(term,n,period),y=n),
               fill="blueviolet") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_laborBigrams_15yr_1995_2010, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("figures/top_laborBigrams_15yr_1995_2010.html",selfcontained = F, libdir = "lib")

```

##### top 20 labor bigrams per 5-year period (since 1965)
```{r top labor bigrams by year 5-yr period, message=FALSE, cache=TRUE}

labor_bigrams_by_year_5yr <- laborBigrams %>%
  filter(year>=1965) %>%
  filter(!(term %in% bad_syntax$phrase)) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 5) %>%
  group_by(period) %>%
  count(term,wt=count) %>%
  top_n(20) %>%
  arrange(desc(n))
save(labor_bigrams_by_year_5yr,file="data/R/tables/laborBigrams_by_5yrs.Rda")


#### 1965 & 1970
top_laborBigrams_5yr_1965_1970 <- ggplot() +
  geom_col(data=filter(labor_bigrams_by_year_5yr,period==1965 | period==1970),
           aes(x=reorder_within(term,n,period),y=n),
               fill="blueviolet") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_laborBigrams_5yr_1965_1970, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("figures/top_laborBigrams_5yr_1965_1970.html",selfcontained = F, libdir = "lib")


#### 1975 & 1980
top_laborBigrams_5yr_1975_1980 <- ggplot() +
  geom_col(data=filter(labor_bigrams_by_year_5yr,period==1975 | period==1980),
           aes(x=reorder_within(term,n,period),y=n),
               fill="blueviolet") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_laborBigrams_5yr_1975_1980, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("figures/top_laborBigrams_5yr_1975_1980.html",selfcontained = F, libdir = "lib")


#### 1985 & 1990
top_laborBigrams_5yr_1985_1990 <- ggplot() +
  geom_col(data=filter(labor_bigrams_by_year_5yr,period==1985 | period==1990),
           aes(x=reorder_within(term,n,period),y=n),
               fill="blueviolet") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_laborBigrams_5yr_1985_1990, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("figures/top_laborBigrams_5yr_1985_1990.html",selfcontained = F, libdir = "lib")


#### 1995 & 2000
top_laborBigrams_5yr_1995_2000 <- ggplot() +
  geom_col(data=filter(labor_bigrams_by_year_5yr,period==1995 | period==2000),
           aes(x=reorder_within(term,n,period),y=n),
               fill="blueviolet") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_laborBigrams_5yr_1995_2000, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("figures/top_laborBigrams_5yr_1995_2000.html",selfcontained = F, libdir = "lib")


#### 2005 & 2010
top_laborBigrams_5yr_2005_2010 <- ggplot() +
  geom_col(data=filter(labor_bigrams_by_year_5yr,period==2005 | period==2010),
           aes(x=reorder_within(term,n,period),y=n),
               fill="blueviolet") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_laborBigrams_5yr_2005_2010, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("figures/top_laborBigrams_5yr_2005_2010.html",selfcontained = F, libdir = "lib")

#### 2015 & 2020
top_laborBigrams_5yr_2015_2020 <- ggplot() +
  geom_col(data=filter(labor_bigrams_by_year_5yr,period==2015 | period==2020),
           aes(x=reorder_within(term,n,period),y=n),
               fill="blueviolet") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_laborBigrams_5yr_2015_2020, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("figures/top_laborBigrams_5yr_2015_2020.html",selfcontained = F, libdir = "lib")

```


#### ENVIRO-LABOR

##### top 25 enviro-labor bigrams
```{r enviroLabor bigram counts , echo=FALSE, cache=FALSE, cache.lazy = FALSE}

enviroLaborBigrams_top25 <- enviroLaborBigrams %>%
  as_tibble() %>%
  count(term,wt=count) %>%
  top_n(25) %>%
  arrange(desc(n))
save(enviroLaborBigrams_top25,file="data/R/tables/enviroLaborBigrams_top25.Rda")

# load(verbose=TRUE,file="data/R/tables/enviroLaborBigrams_count.Rda")

map_enviroLaborBigrams_top25 <- ggplot() +
    geom_col(data=enviroLaborBigrams_top25,
             aes(x=fct_reorder(term,n),
                 y=n,
                 text=paste("<b>",term,":</b> ",n,sep="")),
             #color="blueviolet",
             fill="plum4") +
  coord_flip() +
  theme_minimal() +
  theme(axis.line=element_line(color="#32127a"),
        axis.ticks=element_line(color="#32127a"),
        axis.title.x=element_blank(),
        axis.title.y=element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank())


##### make interactive
ggplotly(map_enviroLaborBigrams_top25, tooltip="text") %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  partial_bundle() %>%
  saveWidget("figures/enviroLabor_bigrams_top25.html", selfcontained = F, libdir = "lib")

```

##### top 20 enviroLabor bigrams per 20-year period (since 1960)
```{r top enviroLabor bigrams by year 20-yr period, message=FALSE, cache=TRUE}

enviroLabor_bigrams_by_year_20yr <- enviroLaborBigrams %>%
  filter(year>=1960 & year<=2019) %>%
  filter(!(term %in% bad_syntax$phrase)) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 20) %>%
  group_by(period) %>%
  count(term,wt=count) %>%
  top_n(20) %>%
  arrange(desc(n))
save(enviroLabor_bigrams_by_year_20yr,file="data/R/tables/enviroLaborBigrams_by_20yrs.Rda")


#### 1960
top_enviroLaborBigrams_20yr_1960 <- ggplot() +
  geom_col(data=filter(enviroLabor_bigrams_by_year_20yr,period==1960),
           aes(x=reorder_within(term,n,period),y=n),
               fill="plum4") +
  coord_flip() +
  scale_x_reordered() +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(title="1960",x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_20yr_1960, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("figures/top_enviroLaborBigrams_20yr_1960.html",selfcontained = F, libdir = "lib")


#### 1980
top_enviroLaborBigrams_20yr_1980 <- ggplot() +
  geom_col(data=filter(enviroLabor_bigrams_by_year_20yr,period==1980),
           aes(x=reorder_within(term,n,period),y=n),
               fill="plum4") +
  coord_flip() +
  scale_x_reordered() +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(title="1980",x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_20yr_1980, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("figures/top_enviroLaborBigrams_20yr_1980.html",selfcontained = F, libdir = "lib")


#### 2000
top_enviroLaborBigrams_20yr_2000 <- ggplot() +
  geom_col(data=filter(enviroLabor_bigrams_by_year_20yr,period==2000),
           aes(x=reorder_within(term,n,period),y=n),
               fill="plum4") +
  coord_flip() +
  scale_x_reordered() +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(title="2000",x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_20yr_2000, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("figures/top_enviroLaborBigrams_20yr_2000.html",selfcontained = F, libdir = "lib")



```

##### top 20 enviroLabor bigrams per 15-year period (since 1965)
```{r top enviroLabor bigrams by year 15-yr period, message=FALSE, cache=TRUE}

enviroLabor_bigrams_by_year_15yr <- enviroLaborBigrams %>%
  filter(year>=1965) %>%
  filter(!(term %in% bad_syntax$phrase)) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 15) %>%
  group_by(period) %>%
  count(term,wt=count) %>%
  top_n(20) %>%
  arrange(desc(n))
save(enviroLabor_bigrams_by_year_15yr,file="data/R/tables/enviroLaborBigrams_by_15yrs.Rda")
  

#### 1965 & 1980
top_enviroLaborBigrams_15yr_1965_1980 <- ggplot() +
  geom_col(data=filter(enviroLabor_bigrams_by_year_15yr,period==1965 | period==1980),
           aes(x=reorder_within(term,n,period),y=n),
               fill="plum4") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_15yr_1965_1980, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("figures/top_enviroLaborBigrams_15yr_1965_1980.html",selfcontained = F, libdir = "lib")


#### 1995 & 2010
top_enviroLaborBigrams_15yr_1995_2010 <- ggplot() +
  geom_col(data=filter(enviroLabor_bigrams_by_year_15yr,period==1995 | period==2010),
           aes(x=reorder_within(term,n,period),y=n),
               fill="plum4") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_15yr_1995_2010, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("figures/top_enviroLaborBigrams_15yr_1995_2010.html",selfcontained = F, libdir = "lib")

```

##### top 20 enviroLabor bigrams per 5-year period (since 1965)
```{r top enviroLabor bigrams by year 5-yr period, message=FALSE, cache=TRUE}

enviroLabor_bigrams_by_year_5yr <- enviroLaborBigrams %>%
  filter(year>=1965) %>%
  filter(!(term %in% bad_syntax$phrase)) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 5) %>%
  group_by(period) %>%
  count(term,wt=count) %>%
  top_n(20) %>%
  arrange(desc(n))
save(enviroLabor_bigrams_by_year_5yr,file="data/R/tables/enviroLaborBigrams_by_5yrs.Rda")


#### 1965 & 1970
top_enviroLaborBigrams_5yr_1965_1970 <- ggplot() +
  geom_col(data=filter(enviroLabor_bigrams_by_year_5yr,period==1965 | period==1970),
           aes(x=reorder_within(term,n,period),y=n),
               fill="plum4") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_5yr_1965_1970, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("figures/top_enviroLaborBigrams_5yr_1965_1970.html",selfcontained = F, libdir = "lib")


#### 1975 & 1980
top_enviroLaborBigrams_5yr_1975_1980 <- ggplot() +
  geom_col(data=filter(enviroLabor_bigrams_by_year_5yr,period==1975 | period==1980),
           aes(x=reorder_within(term,n,period),y=n),
               fill="plum4") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_5yr_1975_1980, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("figures/top_enviroLaborBigrams_5yr_1975_1980.html",selfcontained = F, libdir = "lib")


#### 1985 & 1990
top_enviroLaborBigrams_5yr_1985_1990 <- ggplot() +
  geom_col(data=filter(enviroLabor_bigrams_by_year_5yr,period==1985 | period==1990),
           aes(x=reorder_within(term,n,period),y=n),
               fill="plum4") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_5yr_1985_1990, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("figures/top_enviroLaborBigrams_5yr_1985_1990.html",selfcontained = F, libdir = "lib")


#### 1995 & 2000
top_enviroLaborBigrams_5yr_1995_2000 <- ggplot() +
  geom_col(data=filter(enviroLabor_bigrams_by_year_5yr,period==1995 | period==2000),
           aes(x=reorder_within(term,n,period),y=n),
               fill="plum4") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_5yr_1995_2000, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("figures/top_enviroLaborBigrams_5yr_1995_2000.html",selfcontained = F, libdir = "lib")


#### 2005 & 2010
top_enviroLaborBigrams_5yr_2005_2010 <- ggplot() +
  geom_col(data=filter(enviroLabor_bigrams_by_year_5yr,period==2005 | period==2010),
           aes(x=reorder_within(term,n,period),y=n),
               fill="plum4") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_5yr_2005_2010, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("figures/top_enviroLaborBigrams_5yr_2005_2010.html",selfcontained = F, libdir = "lib")

#### 2015 & 2020
top_enviroLaborBigrams_5yr_2015_2020 <- ggplot() +
  geom_col(data=filter(enviroLabor_bigrams_by_year_5yr,period==2015 | period==2020),
           aes(x=reorder_within(term,n,period),y=n),
               fill="plum4") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_5yr_2015_2020, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("figures/top_enviroLaborBigrams_5yr_2015_2020.html",selfcontained = F, libdir = "lib")

```

##### top 20 enviroLabor bigrams per 2-year period (since 2000)
```{r top enviroLabor bigrams by year 2-yr period, message=FALSE, cache=TRUE}

enviroLabor_bigrams_by_year_2yr <- enviroLaborBigrams %>%
  filter(year>=2000 & year<=2023) %>%
  filter(!(term %in% bad_syntax$phrase)) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 2) %>%
  group_by(period) %>%
  count(term,wt=count) %>%
  top_n(20) %>%
  arrange(desc(n))
save(enviroLabor_bigrams_by_year_2yr,file="data/R/tables/enviroLaborBigrams_by_2yrs.Rda")


#### 2000, 2002
top_enviroLaborBigrams_2yr_2000_2002 <- ggplot() +
  geom_col(data=filter(enviroLabor_bigrams_by_year_2yr,period==2000 | period==2002),
           aes(x=reorder_within(term,n,period),y=n),
               fill="plum4") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_2yr_2000_2002, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("figures/top_enviroLaborBigrams_2yr_2000_2002.html",selfcontained = F, libdir = "lib")


#### 2004, 2006
top_enviroLaborBigrams_2yr_2004_2006 <- ggplot() +
  geom_col(data=filter(enviroLabor_bigrams_by_year_2yr,period==2004 | period==2006),
           aes(x=reorder_within(term,n,period),y=n),
               fill="plum4") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_2yr_2004_2006, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("figures/top_enviroLaborBigrams_2yr_2004_2006.html",selfcontained = F, libdir = "lib")



#### 2008, 2010
top_enviroLaborBigrams_2yr_2008_2010 <- ggplot() +
  geom_col(data=filter(enviroLabor_bigrams_by_year_2yr,period==2008 | period==2010),
           aes(x=reorder_within(term,n,period),y=n),
               fill="plum4") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_2yr_2008_2010, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("figures/top_enviroLaborBigrams_2yr_2008_2010.html",selfcontained = F, libdir = "lib")



#### 2012, 2014
top_enviroLaborBigrams_2yr_2012_2014 <- ggplot() +
  geom_col(data=filter(enviroLabor_bigrams_by_year_2yr,period==2012 | period==2014),
           aes(x=reorder_within(term,n,period),y=n),
               fill="plum4") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_2yr_2012_2014, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("figures/top_enviroLaborBigrams_2yr_2012_2014.html",selfcontained = F, libdir = "lib")


#### 2016, 2018
top_enviroLaborBigrams_2yr_2016_2018 <- ggplot() +
  geom_col(data=filter(enviroLabor_bigrams_by_year_2yr,period==2016 | period==2018),
           aes(x=reorder_within(term,n,period),y=n),
               fill="plum4") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_2yr_2016_2018, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("figures/top_enviroLaborBigrams_2yr_2016_2018.html",selfcontained = F, libdir = "lib")


#### 2020, 2022
top_enviroLaborBigrams_2yr_2020_2022 <- ggplot() +
  geom_col(data=filter(enviroLabor_bigrams_by_year_2yr,period==2020 | period==2022),
           aes(x=reorder_within(term,n,period),y=n),
               fill="plum4") +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(~period, scales = "free", ncol=3) +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(x="",y="count") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggplotly(top_enviroLaborBigrams_2yr_2020_2022, tooltip="text", dynamicTicks = FALSE) %>%
  style(hoverlabel=list(font=list(family="IBM Plex Mono",
                                  size=11))) %>%
  layout(font=list(color="#32127a",family="IBM Plex Mono"),
         xaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a")),
         yaxis=list(color="#32127a",
                    linecolor="#32127a",
                    tickfont=list(color="#32127a"))) %>%
  saveWidget("figures/top_enviroLaborBigrams_2yr_2020_2022.html",selfcontained = F, libdir = "lib")


```


###ANALYSIS: tp-ipf

#### ENVIRO 

```{r enviro 20-yr tf-ipf}

##### ENVIRO #####

enviroBigrams_count_20 <- enviroBigrams %>%
  filter(year>=1960 & year<=2019) %>%
  group_by(year,term) %>%
  count(term,wt=count) %>%
  filter(n>3)

enviro_oneRowPerDocument_20yr <- enviroBigrams_count_20 %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 20) %>%
  group_by(period, term) %>%
  dplyr::summarize(count = sum(n)) %>%
  ungroup() %>%
  mutate(id_number = period) %>%
  filter(!is.na(period)) %>%
  filter(!is.na(term)) %>%
  filter(!is.na(id_number))

enviro_tfidf_20yr <- enviro_oneRowPerDocument_20yr %>%
  bind_tf_idf(term, id_number, count) %>%
  arrange(desc(tf_idf))

# enviro_top_debates <- enviro_tfidf %>%
#   arrange(desc(tf_idf)) %>%
#   slice(seq_len(20)) 

enviro_top_debates_per_unit_20yr <- enviro_tfidf_20yr %>%
  group_by(period) %>%
  arrange(desc(tf_idf)) %>%
  slice(seq_len(25)) %>%
  ungroup() 

tfidf_enviroBigrams_20yr <- enviro_top_debates_per_unit_20yr %>%
  ggplot(aes(y = count,
             x = reorder_within(term, 
                                count, 
                                period, 
                                fun = sum),
             # alpha=tf_idf,
             text = paste("<b>",term,"</b>",
                          "<br>count: ",
                          count,
                          "<br>tf_idf: ",
                          signif(tf_idf,2),
                          sep=""))) +
  geom_col(fill="aquamarine4") +
  facet_wrap(~period, scales = "free", ncol=1) +
  scale_x_reordered() +
  coord_flip() +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(title = "words that distinguished enviro speeches per 20-yr period",
       y = "count",
       x = "") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggsave("figures/tfidf_enviroBigrams_20yr.jpg",w =8, h=11, units = "in") #h=11,


```

```{r enviro 15-yr tf-ipf}

##### ENVIRO #####

enviroBigrams_count <- enviroBigrams %>%
  filter(year>=1965) %>%
  group_by(year,term) %>%
  count(term,wt=count) %>%
  filter(n>3)

enviro_oneRowPerDocument_15yr <- enviroBigrams_count %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 15) %>%
  group_by(period, term) %>%
  dplyr::summarize(count = sum(n)) %>%
  ungroup() %>%
  mutate(id_number = period) %>%
  filter(!is.na(period)) %>%
  filter(!is.na(term)) %>%
  filter(!is.na(id_number))

enviro_tfidf_15yr <- enviro_oneRowPerDocument_15yr %>%
  bind_tf_idf(term, id_number, count) %>%
  arrange(desc(tf_idf))

# enviro_top_debates <- enviro_tfidf %>%
#   arrange(desc(tf_idf)) %>%
#   slice(seq_len(20)) 

enviro_top_debates_per_unit_15yr <- enviro_tfidf_15yr %>%
  group_by(period) %>%
  arrange(desc(tf_idf)) %>%
  slice(seq_len(20)) %>%
  ungroup() 

tfidf_enviroBigrams_15yr <- enviro_top_debates_per_unit_15yr %>%
  ggplot(aes(y = count,
             x = reorder_within(term, 
                                count, 
                                period, 
                                fun = sum),
             # alpha=tf_idf,
             text = paste("<b>",term,"</b>",
                          "<br>count: ",
                          count,
                          "<br>tf_idf: ",
                          signif(tf_idf,2),
                          sep=""))) +
  geom_col(fill="aquamarine4") +
  facet_wrap(~period, scales = "free", ncol=2) +
  scale_x_reordered() +
  coord_flip() +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(title = "words that distinguished enviro speeches per 15-yr period",
       y = "count",
       x = "") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggsave("figures/tfidf_enviroBigrams_15yr.jpg",w =9.5, h=11, units = "in") #h=11,


```

```{r enviro 5-yr tf-ipf}

##### ENVIRO #####

enviro_oneRowPerDocument_5yr <- enviroBigrams_count %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 5) %>%
  group_by(period, term) %>%
  dplyr::summarize(count = sum(n)) %>%
  ungroup() %>%
  mutate(id_number = period) %>%
  filter(!is.na(period)) %>%
  filter(!is.na(term)) %>%
  filter(!is.na(id_number))

enviro_tfidf_5yr <- enviro_oneRowPerDocument_5yr %>%
  bind_tf_idf(term, id_number, count) %>%
  arrange(desc(tf_idf))

# enviro_top_debates <- enviro_tfidf %>%
#   arrange(desc(tf_idf)) %>%
#   slice(seq_len(20)) 

enviro_top_debates_per_unit_5yr <- enviro_tfidf_5yr %>%
  group_by(period) %>%
  arrange(desc(tf_idf)) %>%
  slice(seq_len(15)) %>%
  ungroup() 

tfidf_enviroBigrams_5yr <- enviro_top_debates_per_unit_5yr %>%
  ggplot(aes(y = count,
             x = reorder_within(term, 
                                count, 
                                period, 
                                fun = sum),
             # alpha=tf_idf,
             text = paste("<b>",term,"</b>",
                          "<br>count: ",
                          count,
                          "<br>tf_idf: ",
                          signif(tf_idf,2),
                          sep=""))) +
  geom_col(fill="aquamarine4") +
  facet_wrap(~period, scales = "free", ncol=2) +
  scale_x_reordered() +
  coord_flip() +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(title = "words that distinguished enviro speeches per 5-yr period",
       y = "count",
       x = "") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggsave("figures/tfidf_enviroBigrams_5yr.jpg",w =9, h=14, units = "in") #h=11,


```

#### LABOR 

```{r labor 20-yr tf-ipf}

##### LABOR #####

laborBigrams_count_20 <- laborBigrams %>%
  filter(year>=1960 & year<=2019) %>%
  group_by(year,term) %>%
  count(term,wt=count) %>%
  filter(n>3)

labor_oneRowPerDocument_20yr <- laborBigrams_count_20 %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 20) %>%
  group_by(period, term) %>%
  dplyr::summarize(count = sum(n)) %>%
  ungroup() %>%
  mutate(id_number = period) %>%
  filter(!is.na(period)) %>%
  filter(!is.na(term)) %>%
  filter(!is.na(id_number))

labor_tfidf_20yr <- labor_oneRowPerDocument_20yr %>%
  bind_tf_idf(term, id_number, count) %>%
  arrange(desc(tf_idf))

# labor_top_debates <- labor_tfidf %>%
#   arrange(desc(tf_idf)) %>%
#   slice(seq_len(20)) 

labor_top_debates_per_unit_20yr <- labor_tfidf_20yr %>%
  group_by(period) %>%
  arrange(desc(tf_idf)) %>%
  slice(seq_len(25)) %>%
  ungroup() 

tfidf_laborBigrams_20yr <- labor_top_debates_per_unit_20yr %>%
  ggplot(aes(y = count,
             x = reorder_within(term, 
                                count, 
                                period, 
                                fun = sum),
             # alpha=tf_idf,
             text = paste("<b>",term,"</b>",
                          "<br>count: ",
                          count,
                          "<br>tf_idf: ",
                          signif(tf_idf,2),
                          sep=""))) +
  geom_col(fill="blueviolet") +
  facet_wrap(~period, scales = "free", ncol=1) +
  scale_x_reordered() +
  coord_flip() +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(title = "words that distinguished labor speeches per 20-yr period",
       y = "count",
       x = "") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggsave("figures/tfidf_laborBigrams_20yr.jpg",w =8, h=11, units = "in") #h=11,


```

```{r labor 15-yr tf-ipf}

##### LABOR #####

laborBigrams_count <- laborBigrams %>%
  filter(year>=1965) %>%
  group_by(year,term) %>%
  count(term,wt=count) %>%
  filter(n>3)

labor_oneRowPerDocument_15yr <- laborBigrams_count %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 15) %>%
  group_by(period, term) %>%
  dplyr::summarize(count = sum(n)) %>%
  ungroup() %>%
  mutate(id_number = period) %>%
  filter(!is.na(period)) %>%
  filter(!is.na(term)) %>%
  filter(!is.na(id_number))

labor_tfidf_15yr <- labor_oneRowPerDocument_15yr %>%
  bind_tf_idf(term, id_number, count) %>%
  arrange(desc(tf_idf))

# labor_top_debates <- labor_tfidf %>%
#   arrange(desc(tf_idf)) %>%
#   slice(seq_len(20)) 

labor_top_debates_per_unit_15yr <- labor_tfidf_15yr %>%
  group_by(period) %>%
  arrange(desc(tf_idf)) %>%
  slice(seq_len(20)) %>%
  ungroup() 

tfidf_laborBigrams_15yr <- labor_top_debates_per_unit_15yr %>%
  ggplot(aes(y = count,
             x = reorder_within(term, 
                                count, 
                                period, 
                                fun = sum),
             # alpha=tf_idf,
             text = paste("<b>",term,"</b>",
                          "<br>count: ",
                          count,
                          "<br>tf_idf: ",
                          signif(tf_idf,2),
                          sep=""))) +
  geom_col(fill="blueviolet") +
  facet_wrap(~period, scales = "free", ncol=2) +
  scale_x_reordered() +
  coord_flip() +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(title = "words that distinguished labor speeches per 15-yr period",
       y = "count",
       x = "") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggsave("figures/tfidf_laborBigrams_15yr.jpg",w =9.5, h=11, units = "in") #h=11,


```

```{r labor 5-yr tf-ipf}

##### LABOR #####

labor_oneRowPerDocument_5yr <- laborBigrams_count %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 5) %>%
  group_by(period, term) %>%
  dplyr::summarize(count = sum(n)) %>%
  ungroup() %>%
  mutate(id_number = period) %>%
  filter(!is.na(period)) %>%
  filter(!is.na(term)) %>%
  filter(!is.na(id_number))

labor_tfidf_5yr <- labor_oneRowPerDocument_5yr %>%
  bind_tf_idf(term, id_number, count) %>%
  arrange(desc(tf_idf))

# labor_top_debates <- labor_tfidf %>%
#   arrange(desc(tf_idf)) %>%
#   slice(seq_len(20)) 

labor_top_debates_per_unit_5yr <- labor_tfidf_5yr %>%
  group_by(period) %>%
  arrange(desc(tf_idf)) %>%
  slice(seq_len(15)) %>%
  ungroup() 

tfidf_laborBigrams_5yr <- labor_top_debates_per_unit_5yr %>%
  ggplot(aes(y = count,
             x = reorder_within(term, 
                                count, 
                                period, 
                                fun = sum),
             # alpha=tf_idf,
             text = paste("<b>",term,"</b>",
                          "<br>count: ",
                          count,
                          "<br>tf_idf: ",
                          signif(tf_idf,2),
                          sep=""))) +
  geom_col(fill="blueviolet") +
  facet_wrap(~period, scales = "free", ncol=2) +
  scale_x_reordered() +
  coord_flip() +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(title = "words that distinguished labor speeches per 5-yr period",
       y = "count",
       x = "") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggsave("figures/tfidf_laborBigrams_5yr.jpg",w =9, h=14, units = "in") #h=11,


```

#### ENVIRO-LABOR

```{r enviroLabor 20-yr tf-ipf}

##### ENVIRO-LABOR #####

enviroLaborBigrams_count_20 <- enviroLaborBigrams %>%
  filter(year>=1960 & year<=2019) %>%
  group_by(year,term) %>%
  count(term,wt=count) %>%
  filter(n>3)

enviroLabor_oneRowPerDocument_20yr <- enviroLaborBigrams_count_20 %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 20) %>%
  group_by(period, term) %>%
  dplyr::summarize(count = sum(n)) %>%
  ungroup() %>%
  mutate(id_number = period) %>%
  filter(!is.na(period)) %>%
  filter(!is.na(term)) %>%
  filter(!is.na(id_number))

enviroLabor_tfidf_20yr <- enviroLabor_oneRowPerDocument_20yr %>%
  bind_tf_idf(term, id_number, count) %>%
  arrange(desc(tf_idf))

enviroLabor_top_debates_per_unit_20yr <- enviroLabor_tfidf_20yr %>%
  group_by(period) %>%
  arrange(desc(tf_idf)) %>%
  slice(seq_len(25)) %>%
  ungroup() 

tfidf_enviroLaborBigrams_20yr <- enviroLabor_top_debates_per_unit_20yr %>%
  ggplot(aes(y = count,
             x = reorder_within(term, 
                                count, 
                                period, 
                                fun = sum),
             # alpha=tf_idf,
             text = paste("<b>",term,"</b>",
                          "<br>count: ",
                          count,
                          "<br>tf_idf: ",
                          signif(tf_idf,2),
                          sep=""))) +
  geom_col(fill="plum4") +
  facet_wrap(~period, scales = "free", ncol=1) +
  scale_x_reordered() +
  coord_flip() +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(title = "words that distinguished enviroLabor speeches per 20-yr period",
       y = "count",
       x = "") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggsave("figures/tfidf_enviroLaborBigrams_20yr.jpg",w =8, h=11, units = "in") #h=11,


```

```{r enviroLabor 15-yr tf-ipf}

##### ENVIRO-LABOR #####

enviroLaborBigrams_count <- enviroLaborBigrams %>%
  filter(year>=1965) %>%
  group_by(year,term) %>%
  count(term,wt=count) %>%
  filter(n>3)

enviroLabor_oneRowPerDocument_15yr <- enviroLaborBigrams_count %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 15) %>%
  group_by(period, term) %>%
  dplyr::summarize(count = sum(n)) %>%
  ungroup() %>%
  mutate(id_number = period) %>%
  filter(!is.na(period)) %>%
  filter(!is.na(term)) %>%
  filter(!is.na(id_number))

enviroLabor_tfidf_15yr <- enviroLabor_oneRowPerDocument_15yr %>%
  bind_tf_idf(term, id_number, count) %>%
  arrange(desc(tf_idf))

enviroLabor_top_debates_per_unit_15yr <- enviroLabor_tfidf_15yr %>%
  group_by(period) %>%
  arrange(desc(tf_idf)) %>%
  slice(seq_len(20)) %>%
  ungroup() 

tfidf_enviroLaborBigrams_15yr <- enviroLabor_top_debates_per_unit_15yr %>%
  ggplot(aes(y = count,
             x = reorder_within(term, 
                                count, 
                                period, 
                                fun = sum),
             # alpha=tf_idf,
             text = paste("<b>",term,"</b>",
                          "<br>count: ",
                          count,
                          "<br>tf_idf: ",
                          signif(tf_idf,2),
                          sep=""))) +
  geom_col(fill="plum4") +
  facet_wrap(~period, scales = "free", ncol=2) +
  scale_x_reordered() +
  coord_flip() +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(title = "words that distinguished enviroLabor speeches per 15-yr period",
       y = "count",
       x = "") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggsave("figures/tfidf_enviroLaborBigrams_15yr.jpg",w =9.5, h=11, units = "in") #h=11,


```

```{r enviroLabor 5-yr tf-ipf}

##### ENVIRO-LABOR #####

enviroLabor_oneRowPerDocument_5yr <- enviroLaborBigrams_count %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 5) %>%
  group_by(period, term) %>%
  dplyr::summarize(count = sum(n)) %>%
  ungroup() %>%
  mutate(id_number = period) %>%
  filter(!is.na(period)) %>%
  filter(!is.na(term)) %>%
  filter(!is.na(id_number))

enviroLabor_tfidf_5yr <- enviroLabor_oneRowPerDocument_5yr %>%
  bind_tf_idf(term, id_number, count) %>%
  arrange(desc(tf_idf))

enviroLabor_top_debates_per_unit_5yr <- enviroLabor_tfidf_5yr %>%
  group_by(period) %>%
  arrange(desc(tf_idf)) %>%
  slice(seq_len(15)) %>%
  ungroup() 

tfidf_enviroLaborBigrams_5yr <- enviroLabor_top_debates_per_unit_5yr %>%
  ggplot(aes(y = count,
             x = reorder_within(term, 
                                count, 
                                period, 
                                fun = sum),
             # alpha=tf_idf,
             text = paste("<b>",term,"</b>",
                          "<br>count: ",
                          count,
                          "<br>tf_idf: ",
                          signif(tf_idf,2),
                          sep=""))) +
  geom_col(fill="plum4") +
  facet_wrap(~period, scales = "free", ncol=2) +
  scale_x_reordered() +
  coord_flip() +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(title = "words that distinguished enviroLabor speeches per 5-yr period",
       y = "count",
       x = "") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggsave("figures/tfidf_enviroLaborBigrams_5yr.jpg",w =9, h=14, units = "in") #h=11,


```

```{r enviroLabor 2-yr tf-ipf}

##### ENVIRO-LABOR #####

enviroLaborBigrams_count_2000 <- enviroLaborBigrams %>%
  filter(year>=2000 & year<=2023) %>%
  group_by(year,term) %>%
  count(term,wt=count) %>%
  filter(n>3)

enviroLabor_oneRowPerDocument_2yr <- enviroLaborBigrams_count_2000 %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 2) %>%
  group_by(period, term) %>%
  dplyr::summarize(count = sum(n)) %>%
  ungroup() %>%
  mutate(id_number = period) %>%
  filter(!is.na(period)) %>%
  filter(!is.na(term)) %>%
  filter(!is.na(id_number))

enviroLabor_tfidf_2yr <- enviroLabor_oneRowPerDocument_2yr %>%
  bind_tf_idf(term, id_number, count) %>%
  arrange(desc(tf_idf))

enviroLabor_top_debates_per_unit_2yr <- enviroLabor_tfidf_2yr %>%
  group_by(period) %>%
  arrange(desc(tf_idf)) %>%
  slice(seq_len(15)) %>%
  ungroup() 

tfidf_enviroLaborBigrams_2yr <- enviroLabor_top_debates_per_unit_2yr %>%
  ggplot(aes(y = count,
             x = reorder_within(term, 
                                count, 
                                period, 
                                fun = sum),
             # alpha=tf_idf,
             text = paste("<b>",term,"</b>",
                          "<br>count: ",
                          count,
                          "<br>tf_idf: ",
                          signif(tf_idf,2),
                          sep=""))) +
  geom_col(fill="plum4") +
  facet_wrap(~period, scales = "free", ncol=2) +
  scale_x_reordered() +
  coord_flip() +
  guides(fill=FALSE, color = FALSE, line = FALSE) +
  labs(title = "words that distinguished enviroLabor speeches per 2-yr period",
       y = "count",
       x = "") +
  theme_minimal() +
  theme(#aspect.ratio=8/11,
    plot.title=element_text(family="IBM Plex Mono",color="#32127a",hjust=0.5,size=12,face="bold"),
    axis.title=element_text(family="IBM Plex Mono",color="#32127a"),
    axis.text=element_text(family="IBM Plex Mono",color="#32127a"),#,size=10),
    axis.line=element_line(color="#32127a"),
    axis.ticks=element_line(color="#32127a"),
    strip.text=element_text(family="IBM Plex Mono",color="#32127a",face="bold"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank())

ggsave("figures/tfidf_enviroLaborBigrams_2yr.jpg",w =9.5, h=13, units = "in") #h=11,


```


### ANALYSIS: co-occurrence networks

#### ENVIRO-LABOR
```{r enviroLabor token co-occurence per 15-yr period}

enviroLaborTokens_wordPairs_corr_1965 <- enviroLaborTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 15) %>%
  filter(period==1965) %>%
  group_by(term) %>%
  filter(n() >= 20) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(correlation!=Inf)

set.seed(2016)
enviroLaborTokens_wordPairs_corr_1965 %>%
  # filter(correlation > .15) %>%
  slice_max(correlation,n=100) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "plum4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroLaborTokens_wordPairs_corr_1965.jpg") #h=11,


enviroLaborTokens_wordPairs_corr_1980 <- enviroLaborTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 15) %>%
  filter(period==1980) %>%
  group_by(term) %>%
  filter(n() >= 20) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(correlation!=Inf)

set.seed(2016)
enviroLaborTokens_wordPairs_corr_1980 %>%
  # filter(correlation > .15) %>%
  slice_max(correlation,n=100) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "plum4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroLaborTokens_wordPairs_corr_1980.jpg") #h=11,


enviroLaborTokens_wordPairs_corr_1995 <- enviroLaborTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 15) %>%
  filter(period==1995) %>%
  group_by(term) %>%
  filter(n() >= 20) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(correlation!=Inf)

set.seed(2016)
enviroLaborTokens_wordPairs_corr_1995 %>%
  # filter(correlation > .15) %>%
  slice_max(correlation,n=100) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "plum4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroLaborTokens_wordPairs_corr_1995.jpg") #h=11,

enviroLaborTokens_wordPairs_corr_2010 <- enviroLaborTokens %>%
  select(document,term,count,year,date) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 15) %>%
  filter(period==2010) %>%
  group_by(term) %>%
  filter(n() >= 20) %>%
  pairwise_cor(term,date,sort=TRUE) %>%
  filter(correlation!=Inf)

set.seed(2016)
enviroLaborTokens_wordPairs_corr_2010 %>%
  # filter(correlation <=0.8 & correlation > .45) %>%
  slice_max(correlation,n=100) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "plum4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroLaborTokens_wordPairs_corr_2010.jpg") #h=11,
```

```{r enviroLabor token co-occurence per 5-yr period}

#### 1965
enviroLaborTokens_wordPairs_corr_5yr_1965 <- enviroLaborTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 5) %>%
  filter(period==1965) %>%
  group_by(term) %>%
  filter(n() >= 20) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(correlation!=Inf)

set.seed(2016)
enviroLaborTokens_wordPairs_corr_5yr_1965 %>%
  # filter(correlation > .15) %>%
  slice_max(correlation,n=100) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "plum4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroLaborTokens_wordPairs_corr_5yr_1965.jpg") #h=11,


#### 1970
enviroLaborTokens_wordPairs_corr_5yr_1970 <- enviroLaborTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 5) %>%
  filter(period==1970) %>%
  group_by(term) %>%
  filter(n() >= 20) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(correlation!=Inf)

set.seed(2016)
enviroLaborTokens_wordPairs_corr_5yr_1970 %>%
  # filter(correlation > .15) %>%
  slice_max(correlation,n=100) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "plum4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroLaborTokens_wordPairs_corr_5yr_1970.jpg") #h=11,

#### 1975
enviroLaborTokens_wordPairs_corr_5yr_1975 <- enviroLaborTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 5) %>%
  filter(period==1975) %>%
  group_by(term) %>%
  filter(n() >= 20) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(correlation!=Inf)

set.seed(2016)
enviroLaborTokens_wordPairs_corr_5yr_1975 %>%
  # filter(correlation > .15) %>%
  slice_max(correlation,n=100) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "plum4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroLaborTokens_wordPairs_corr_5yr_1975.jpg") #h=11,


#### 1980
enviroLaborTokens_wordPairs_corr_5yr_1980 <- enviroLaborTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 5) %>%
  filter(period==1980) %>%
  group_by(term) %>%
  filter(n() >= 20) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(correlation!=Inf)

set.seed(2016)
enviroLaborTokens_wordPairs_corr_5yr_1980 %>%
  # filter(correlation > .15) %>%
  slice_max(correlation,n=100) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "plum4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroLaborTokens_wordPairs_corr_5yr_1980.jpg") #h=11,


#### 1985
enviroLaborTokens_wordPairs_corr_5yr_1985 <- enviroLaborTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 5) %>%
  filter(period==1985) %>%
  group_by(term) %>%
  filter(n() >= 20) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(correlation!=Inf)

set.seed(2016)
enviroLaborTokens_wordPairs_corr_5yr_1985 %>%
  # filter(correlation > .15) %>%
  slice_max(correlation,n=100) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "plum4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroLaborTokens_wordPairs_corr_5yr_1985.jpg") #h=11,


#### 1990
enviroLaborTokens_wordPairs_corr_5yr_1990 <- enviroLaborTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 5) %>%
  filter(period==1990) %>%
  group_by(term) %>%
  filter(n() >= 20) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(correlation!=Inf)

set.seed(2016)
enviroLaborTokens_wordPairs_corr_5yr_1990 %>%
  # filter(correlation > .15) %>%
  slice_max(correlation,n=100) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "plum4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroLaborTokens_wordPairs_corr_5yr_1990.jpg") #h=11,


#### 1995
enviroLaborTokens_wordPairs_corr_5yr_1995 <- enviroLaborTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 5) %>%
  filter(period==1995) %>%
  group_by(term) %>%
  filter(n() >= 20) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(correlation!=Inf)

set.seed(2016)
enviroLaborTokens_wordPairs_corr_5yr_1995 %>%
  # filter(correlation > .15) %>%
  slice_max(correlation,n=100) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "plum4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroLaborTokens_wordPairs_corr_5yr_1995.jpg") #h=11,


#### 2000
enviroLaborTokens_wordPairs_corr_5yr_2000 <- enviroLaborTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 5) %>%
  filter(period==2000) %>%
  group_by(term) %>%
  filter(n() >= 20) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(correlation!=Inf)

set.seed(2016)
enviroLaborTokens_wordPairs_corr_5yr_2000 %>%
  # filter(correlation > .15) %>%
  slice_max(correlation,n=100) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "plum4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroLaborTokens_wordPairs_corr_5yr_2000.jpg") #h=11,

#### 2005
enviroLaborTokens_wordPairs_corr_5yr_2005 <- enviroLaborTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 5) %>%
  filter(period==2005) %>%
  group_by(term) %>%
  filter(n() >= 20) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(correlation!=Inf)

set.seed(2016)
enviroLaborTokens_wordPairs_corr_5yr_2005 %>%
  # filter(correlation > .15) %>%
  slice_max(correlation,n=100) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "plum4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroLaborTokens_wordPairs_corr_5yr_2005.jpg") #h=11,


#### 2010
enviroLaborTokens_wordPairs_corr_5yr_2010 <- enviroLaborTokens %>%
  select(document,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 5) %>%
  filter(period==2010) %>%
  group_by(term) %>%
  filter(n() >= 20) %>%
  pairwise_cor(term,document,sort=TRUE) %>%
  filter(correlation!=Inf)

set.seed(20)
enviroLaborTokens_wordPairs_corr_5yr_2010 %>%
  # filter(correlation <=0.8 & correlation > .45) %>%
  slice_max(correlation,n=100) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "plum4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroLaborTokens_wordPairs_corr_5yr_2010.jpg") #h=11,


#### 2015
enviroLaborTokens_wordPairs_corr_5yr_2015 <- enviroLaborTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 5) %>%
  filter(period==2015) %>%
  group_by(term) %>%
  filter(n() >= 20) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(correlation!=Inf)

set.seed(2016)
enviroLaborTokens_wordPairs_corr_5yr_2015 %>%
  # filter(correlation > .15) %>%
  slice_max(correlation,n=100) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "plum4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroLaborTokens_wordPairs_corr_5yr_2015.jpg") #h=11,


#### 2020
enviroLaborTokens_wordPairs_corr_5yr_2020 <- enviroLaborTokens %>%
  select(document,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 5) %>%
  filter(period==2020) %>%
  group_by(term) %>%
  filter(n() >= 20) %>%
  pairwise_cor(term,document,sort=TRUE) %>%
  filter(correlation!=Inf)

set.seed(2016)
enviroLaborTokens_wordPairs_corr_5yr_2020 %>%
  # filter(correlation <=0.8 & correlation > .45) %>%
  slice_max(correlation,n=100) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "plum4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroLaborTokens_wordPairs_corr_5yr_2020.jpg") #h=11,
```

```{r enviroLabor bigram co-occurence per 15-yr period}

enviroLaborBigrams_wordPairs_corr_1965 <- enviroLaborBigrams %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 15) %>%
  filter(period==1965) %>%
  group_by(term) %>%
  filter(n() >= 15) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(correlation!=Inf)

set.seed(2016)
enviroLaborBigrams_wordPairs_corr_1965 %>%
  filter(correlation < 0.95) %>%
  slice_max(correlation,n=50) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "plum4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroLaborBigrams_wordPairs_corr_1965.jpg") #h=11,


enviroLaborBigrams_wordPairs_corr_1980 <- enviroLaborBigrams %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 15) %>%
  filter(period==1980) %>%
  group_by(term) %>%
  filter(n() >= 15) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(correlation!=Inf)

set.seed(2016)
enviroLaborBigrams_wordPairs_corr_1980 %>%
  filter(correlation < 0.95) %>%
  slice_max(correlation,n=50) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "plum4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroLaborBigrams_wordPairs_corr_1980.jpg") #h=11,


enviroLaborBigrams_wordPairs_corr_1995 <- enviroLaborBigrams %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 15) %>%
  filter(period==1995) %>%
  group_by(term) %>%
  filter(n() >= 15) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(correlation!=Inf)

set.seed(2016)
enviroLaborBigrams_wordPairs_corr_1995 %>%
  filter(correlation < 0.95) %>%
  slice_max(correlation,n=50) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "plum4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroLaborBigrams_wordPairs_corr_1995.jpg") #h=11,

enviroLaborBigrams_wordPairs_corr_2010 <- enviroLaborBigrams %>%
  select(document,term,count,year,date) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 15) %>%
  filter(period==2010) %>%
  group_by(term) %>%
  filter(n() >= 15) %>%
  pairwise_cor(term,date,sort=TRUE) %>%
  filter(correlation!=Inf)

set.seed(2016)
enviroLaborBigrams_wordPairs_corr_2010 %>%
  filter(correlation < 0.95) %>%
  slice_max(correlation,n=50) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "plum4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroLaborBigrams_wordPairs_corr_2010.jpg") #h=11,
```

```{r enviroLabor bigram co-occurence per 5-yr period}

#### 1965
enviroLaborBigrams_wordPairs_corr_5yr_1965 <- enviroLaborBigrams %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 5) %>%
  filter(period==1965) %>%
  group_by(term) %>%
  filter(n() >= 5) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(correlation!=Inf)

set.seed(2016)
enviroLaborBigrams_wordPairs_corr_5yr_1965 %>%
  filter(correlation < 0.95) %>%
  slice_max(correlation,n=50) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "plum4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroLaborBigrams_wordPairs_corr_5yr_1965.jpg") #h=11,


#### 1970
enviroLaborBigrams_wordPairs_corr_5yr_1970 <- enviroLaborBigrams %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 5) %>%
  filter(period==1970) %>%
  group_by(term) %>%
  filter(n() >= 5) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(correlation!=Inf)

set.seed(2016)
enviroLaborBigrams_wordPairs_corr_5yr_1970 %>%
  filter(correlation < 0.95) %>%
  slice_max(correlation,n=50) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "plum4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroLaborBigrams_wordPairs_corr_5yr_1970.jpg") #h=11,

#### 1975
enviroLaborBigrams_wordPairs_corr_5yr_1975 <- enviroLaborBigrams %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 5) %>%
  filter(period==1975) %>%
  group_by(term) %>%
  filter(n() >= 5) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(correlation!=Inf)

set.seed(2016)
enviroLaborBigrams_wordPairs_corr_5yr_1975 %>%
  filter(correlation < 0.95) %>%
  slice_max(correlation,n=50) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "plum4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroLaborBigrams_wordPairs_corr_5yr_1975.jpg") #h=11,


#### 1980
enviroLaborBigrams_wordPairs_corr_5yr_1980 <- enviroLaborBigrams %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 5) %>%
  filter(period==1980) %>%
  group_by(term) %>%
  filter(n() >= 5) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(correlation!=Inf)

set.seed(2016)
enviroLaborBigrams_wordPairs_corr_5yr_1980 %>%
  filter(correlation < 0.95) %>%
  slice_max(correlation,n=50) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "plum4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroLaborBigrams_wordPairs_corr_5yr_1980.jpg") #h=11,


#### 1985
enviroLaborBigrams_wordPairs_corr_5yr_1985 <- enviroLaborBigrams %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 5) %>%
  filter(period==1985) %>%
  group_by(term) %>%
  filter(n() >= 5) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(correlation!=Inf)

set.seed(2016)
enviroLaborBigrams_wordPairs_corr_5yr_1985 %>%
  filter(correlation < 0.95) %>%
  slice_max(correlation,n=50) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "plum4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroLaborBigrams_wordPairs_corr_5yr_1985.jpg") #h=11,


#### 1990
enviroLaborBigrams_wordPairs_corr_5yr_1990 <- enviroLaborBigrams %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 5) %>%
  filter(period==1990) %>%
  group_by(term) %>%
  filter(n() >= 5) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(correlation!=Inf)

set.seed(2016)
enviroLaborBigrams_wordPairs_corr_5yr_1990 %>%
  filter(correlation < 0.95) %>%
  slice_max(correlation,n=50) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "plum4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroLaborBigrams_wordPairs_corr_5yr_1990.jpg") #h=11,


#### 1995
enviroLaborBigrams_wordPairs_corr_5yr_1995 <- enviroLaborBigrams %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 5) %>%
  filter(period==1995) %>%
  group_by(term) %>%
  filter(n() >= 5) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(correlation!=Inf)

set.seed(2016)
enviroLaborBigrams_wordPairs_corr_5yr_1995 %>%
  filter(correlation < 0.95) %>%
  slice_max(correlation,n=50) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "plum4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroLaborBigrams_wordPairs_corr_5yr_1995.jpg") #h=11,


#### 2000
enviroLaborBigrams_wordPairs_corr_5yr_2000 <- enviroLaborBigrams %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 5) %>%
  filter(period==2000) %>%
  group_by(term) %>%
  filter(n() >= 5) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(correlation!=Inf)

set.seed(2016)
enviroLaborBigrams_wordPairs_corr_5yr_2000 %>%
  filter(correlation < 0.95) %>%
  slice_max(correlation,n=50) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "plum4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroLaborBigrams_wordPairs_corr_5yr_2000.jpg") #h=11,

#### 2005
enviroLaborBigrams_wordPairs_corr_5yr_2005 <- enviroLaborBigrams %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 5) %>%
  filter(period==2005) %>%
  group_by(term) %>%
  filter(n() >= 5) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(correlation!=Inf)

set.seed(2016)
enviroLaborBigrams_wordPairs_corr_5yr_2005 %>%
filter(correlation < 0.95) %>%
  slice_max(correlation,n=50) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "plum4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroLaborBigrams_wordPairs_corr_5yr_2005.jpg") #h=11,


#### 2010
enviroLaborBigrams_wordPairs_corr_5yr_2010 <- enviroLaborBigrams %>%
  select(document,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 5) %>%
  filter(period==2010) %>%
  group_by(term) %>%
  filter(n() >= 5) %>%
  pairwise_cor(term,document,sort=TRUE) %>%
  filter(correlation!=Inf)

set.seed(2016)
enviroLaborBigrams_wordPairs_corr_5yr_2010 %>%
  filter(correlation < 0.95) %>%
  slice_max(correlation,n=50) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "plum4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroLaborBigrams_wordPairs_corr_5yr_2010.jpg") #h=11,


#### 2015
enviroLaborBigrams_wordPairs_corr_5yr_2015 <- enviroLaborBigrams %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 5) %>%
  filter(period==2015) %>%
  group_by(term) %>%
  filter(n() >= 5) %>%
  pairwise_cor(term,speech_id,sort=TRUE) %>%
  filter(correlation!=Inf)

set.seed(2016)
enviroLaborBigrams_wordPairs_corr_5yr_2015 %>%
  filter(correlation < 0.95) %>%
  slice_max(correlation,n=50) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "plum4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroLaborBigrams_wordPairs_corr_5yr_2015.jpg") #h=11,


#### 2020
enviroLaborBigrams_wordPairs_corr_5yr_2020 <- enviroLaborBigrams %>%
  select(document,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 5) %>%
  filter(period==2020) %>%
  group_by(term) %>%
  filter(n() >= 5) %>%
  pairwise_cor(term,document,sort=TRUE) %>%
  filter(correlation!=Inf)

set.seed(2016)
enviroLaborBigrams_wordPairs_corr_5yr_2020 %>%
  filter(correlation < 0.95) %>%
  slice_max(correlation,n=50) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "plum4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroLaborBigrams_wordPairs_corr_5yr_2020.jpg") #h=11,
```

#### ENVIRO
```{r enviro 15-yr co-occurence}

#### 1965
enviroTokens_wordPairs_corr_1965 <- enviroTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 15) %>%
  filter(period==1965) %>%
  group_by(term) %>%
  filter(n() >= 20) %>%
  pairwise_cor(term,speech_id,sort=TRUE)

enviroTokens_wordPairs_corr_1965_labor <- enviroTokens_wordPairs_corr_1965 %>%
  # filter(item1 %in% c("labor"))
  filter(item1 %in% c("labor","worker","job"))

set.seed(2016)
enviroTokens_wordPairs_corr_1965_labor %>%
  # filter(correlation > .15) %>%
  slice_max(correlation,n=50) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "aquamarine4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroTokens_wordPairs_corr_1965_labor.jpg") #h=11,


#### 1980
enviroTokens_wordPairs_corr_1980 <- enviroTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 15) %>%
  filter(period==1980) %>%
  group_by(term) %>%
  filter(n() >= 20) %>%
  pairwise_cor(term,speech_id,sort=TRUE)

enviroTokens_wordPairs_corr_1980_labor <- enviroTokens_wordPairs_corr_1980 %>%
  # filter(item1 %in% c("labor"))
  filter(item1 %in% c("labor","worker","job"))

set.seed(2016)
enviroTokens_wordPairs_corr_1980_labor %>%
  # filter(correlation > .15) %>%
  slice_max(correlation,n=50) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "aquamarine4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroTokens_wordPairs_corr_1980_labor.jpg") #h=11,




#### 1995
enviroTokens_wordPairs_corr_1995 <- enviroTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 15) %>%
  filter(period==1995) %>%
  group_by(term) %>%
  filter(n() >= 20) %>%
  pairwise_cor(term,speech_id,sort=TRUE)

enviroTokens_wordPairs_corr_1995_labor <- enviroTokens_wordPairs_corr_1995 %>%
  # filter(item1 %in% c("labor"))
  filter(item1 %in% c("labor","worker","job"))

set.seed(2016)
enviroTokens_wordPairs_corr_1995_labor %>%
  # filter(correlation > .15) %>%
  slice_max(correlation,n=50) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "aquamarine4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroTokens_wordPairs_corr_1995_labor.jpg") #h=11,


#### 2010
enviroTokens_wordPairs_corr_2010 <- enviroTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 15) %>%
  filter(period==2010) %>%
  group_by(term) %>%
  filter(n() >= 20) %>%
  pairwise_cor(term,speech_id,sort=TRUE)

enviroTokens_wordPairs_corr_2010_labor <- enviroTokens_wordPairs_corr_2010 %>%
  # filter(item1 %in% c("labor"))
  filter(item1 %in% c("labor","worker","job"))

set.seed(2016)
enviroTokens_wordPairs_corr_2010_labor %>%
  # filter(correlation > .15) %>%
  slice_max(correlation,n=50) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "aquamarine4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroTokens_wordPairs_corr_2010_labor.jpg") #h=11,


```

```{r enviro 5-yr co-occurence}

#### 1965
enviroTokens_wordPairs_corr_5yr_1965 <- enviroTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 5) %>%
  filter(period==1965) %>%
  group_by(term) %>%
  filter(n() >= 20) %>%
  pairwise_cor(term,speech_id,sort=TRUE)

enviroTokens_wordPairs_corr_5yr_1965_labor <- enviroTokens_wordPairs_corr_5yr_1965 %>%
  # filter(item1 %in% c("labor"))
  filter(item1 %in% c("labor","worker","job"))

set.seed(2016)
enviroTokens_wordPairs_corr_5yr_1965_labor %>%
  # filter(correlation > .15) %>%
  slice_max(correlation,n=50) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "aquamarine4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroTokens_wordPairs_corr_5yr_1965_labor.jpg") #h=11,


#### 1970
enviroTokens_wordPairs_corr_5yr_1970 <- enviroTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 5) %>%
  filter(period==1970) %>%
  group_by(term) %>%
  filter(n() >= 20) %>%
  pairwise_cor(term,speech_id,sort=TRUE)

enviroTokens_wordPairs_corr_5yr_1970_labor <- enviroTokens_wordPairs_corr_5yr_1970 %>%
  # filter(item1 %in% c("labor"))
  filter(item1 %in% c("labor","worker","job"))

set.seed(2016)
enviroTokens_wordPairs_corr_5yr_1970_labor %>%
  # filter(correlation > .15) %>%
  slice_max(correlation,n=50) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "aquamarine4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroTokens_wordPairs_corr_5yr_1970_labor.jpg") #h=11,

#### 1975
enviroTokens_wordPairs_corr_5yr_1975 <- enviroTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 5) %>%
  filter(period==1975) %>%
  group_by(term) %>%
  filter(n() >= 20) %>%
  pairwise_cor(term,speech_id,sort=TRUE)

enviroTokens_wordPairs_corr_5yr_1975_labor <- enviroTokens_wordPairs_corr_5yr_1975 %>%
  # filter(item1 %in% c("labor"))
  filter(item1 %in% c("labor","worker","job"))

set.seed(2016)
enviroTokens_wordPairs_corr_5yr_1975_labor %>%
  # filter(correlation > .15) %>%
  slice_max(correlation,n=50) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "aquamarine4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroTokens_wordPairs_corr_5yr_1975_labor.jpg") #h=11,


#### 1980
enviroTokens_wordPairs_corr_5yr_1980 <- enviroTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 5) %>%
  filter(period==1980) %>%
  group_by(term) %>%
  filter(n() >= 20) %>%
  pairwise_cor(term,speech_id,sort=TRUE)

enviroTokens_wordPairs_corr_5yr_1980_labor <- enviroTokens_wordPairs_corr_5yr_1980 %>%
  # filter(item1 %in% c("labor"))
  filter(item1 %in% c("labor","worker","job"))

set.seed(2016)
enviroTokens_wordPairs_corr_5yr_1980_labor %>%
  # filter(correlation > .15) %>%
  slice_max(correlation,n=50) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "aquamarine4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroTokens_wordPairs_corr_5yr_1980_labor.jpg") #h=11,


#### 1985
enviroTokens_wordPairs_corr_5yr_1985 <- enviroTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 5) %>%
  filter(period==1985) %>%
  group_by(term) %>%
  filter(n() >= 20) %>%
  pairwise_cor(term,speech_id,sort=TRUE)

enviroTokens_wordPairs_corr_5yr_1985_labor <- enviroTokens_wordPairs_corr_5yr_1985 %>%
  # filter(item1 %in% c("labor"))
  filter(item1 %in% c("labor","worker","job"))

set.seed(2016)
enviroTokens_wordPairs_corr_5yr_1985_labor %>%
  # filter(correlation > .15) %>%
  slice_max(correlation,n=50) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "aquamarine4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroTokens_wordPairs_corr_5yr_1985_labor.jpg") #h=11,

#### 1990
enviroTokens_wordPairs_corr_5yr_1990 <- enviroTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 5) %>%
  filter(period==1990) %>%
  group_by(term) %>%
  filter(n() >= 20) %>%
  pairwise_cor(term,speech_id,sort=TRUE)

enviroTokens_wordPairs_corr_5yr_1990_labor <- enviroTokens_wordPairs_corr_5yr_1990 %>%
  # filter(item1 %in% c("labor"))
  filter(item1 %in% c("labor","worker","job"))

set.seed(2016)
enviroTokens_wordPairs_corr_5yr_1990_labor %>%
  # filter(correlation > .15) %>%
  slice_max(correlation,n=50) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "aquamarine4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroTokens_wordPairs_corr_5yr_1990_labor.jpg") #h=11,


#### 1995
enviroTokens_wordPairs_corr_5yr_1995 <- enviroTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 5) %>%
  filter(period==1995) %>%
  group_by(term) %>%
  filter(n() >= 20) %>%
  pairwise_cor(term,speech_id,sort=TRUE)

enviroTokens_wordPairs_corr_5yr_1995_labor <- enviroTokens_wordPairs_corr_5yr_1995 %>%
  # filter(item1 %in% c("labor"))
  filter(item1 %in% c("labor","worker","job"))

set.seed(2016)
enviroTokens_wordPairs_corr_5yr_1995_labor %>%
  # filter(correlation > .15) %>%
  slice_max(correlation,n=50) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "aquamarine4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroTokens_wordPairs_corr_5yr_1995_labor.jpg") #h=11,


#### 2000
enviroTokens_wordPairs_corr_5yr_2000 <- enviroTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 5) %>%
  filter(period==2000) %>%
  group_by(term) %>%
  filter(n() >= 20) %>%
  pairwise_cor(term,speech_id,sort=TRUE)

enviroTokens_wordPairs_corr_5yr_2000_labor <- enviroTokens_wordPairs_corr_5yr_2000 %>%
  # filter(item1 %in% c("labor"))
  filter(item1 %in% c("labor","worker","job"))

set.seed(2016)
enviroTokens_wordPairs_corr_5yr_2000_labor %>%
  # filter(correlation > .15) %>%
  slice_max(correlation,n=50) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "aquamarine4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroTokens_wordPairs_corr_5yr_2000_labor.jpg") #h=11,


#### 2005
enviroTokens_wordPairs_corr_5yr_2005 <- enviroTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 5) %>%
  filter(period==2005) %>%
  group_by(term) %>%
  filter(n() >= 20) %>%
  pairwise_cor(term,speech_id,sort=TRUE)

enviroTokens_wordPairs_corr_5yr_2005_labor <- enviroTokens_wordPairs_corr_5yr_2005 %>%
  # filter(item1 %in% c("labor"))
  filter(item1 %in% c("labor","worker","job"))

set.seed(2016)
enviroTokens_wordPairs_corr_5yr_2005_labor %>%
  # filter(correlation > .15) %>%
  slice_max(correlation,n=50) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "aquamarine4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroTokens_wordPairs_corr_5yr_2005_labor.jpg") #h=11,


#### 2010
enviroTokens_wordPairs_corr_5yr_2010 <- enviroTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 5) %>%
  filter(period==2010) %>%
  group_by(term) %>%
  filter(n() >= 20) %>%
  pairwise_cor(term,speech_id,sort=TRUE)

enviroTokens_wordPairs_corr_5yr_2010_labor <- enviroTokens_wordPairs_corr_5yr_2010 %>%
  # filter(item1 %in% c("labor"))
  filter(item1 %in% c("labor","worker","job"))

set.seed(2016)
enviroTokens_wordPairs_corr_5yr_2010_labor %>%
  # filter(correlation > .15) %>%
  slice_max(correlation,n=50) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "aquamarine4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroTokens_wordPairs_corr_5yr_2010_labor.jpg") #h=11,

#### 2015
enviroTokens_wordPairs_corr_5yr_2015 <- enviroTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 5) %>%
  filter(period==2015) %>%
  group_by(term) %>%
  filter(n() >= 20) %>%
  pairwise_cor(term,speech_id,sort=TRUE)

enviroTokens_wordPairs_corr_5yr_2015_labor <- enviroTokens_wordPairs_corr_5yr_2015 %>%
  # filter(item1 %in% c("labor"))
  filter(item1 %in% c("labor","worker","job"))

set.seed(2016)
enviroTokens_wordPairs_corr_5yr_2015_labor %>%
  # filter(correlation > .15) %>%
  slice_max(correlation,n=50) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "aquamarine4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroTokens_wordPairs_corr_5yr_2015_labor.jpg") #h=11,


#### 2020
enviroTokens_wordPairs_corr_5yr_2020 <- enviroTokens %>%
  select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 5) %>%
  filter(period==2020) %>%
  group_by(term) %>%
  filter(n() >= 20) %>%
  pairwise_cor(term,speech_id,sort=TRUE)

enviroTokens_wordPairs_corr_5yr_2020_labor <- enviroTokens_wordPairs_corr_5yr_2020 %>%
  # filter(item1 %in% c("labor"))
  filter(item1 %in% c("labor","worker","job"))

set.seed(2016)
enviroTokens_wordPairs_corr_5yr_2020_labor %>%
  # filter(correlation > .15) %>%
  slice_max(correlation,n=50) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "aquamarine4", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
ggsave("figures/enviroTokens_wordPairs_corr_5yr_2020_labor.jpg") #h=11,
```


###ANALYSIS: topic modeling

```{r enviroLabor topics per 15-yr period r}

##### 1965 #####
enviroLaborBigrams_1965_dtm <- enviroLaborSpeeches %>%
  filter(environment=="Yes" & labor=="Yes") %>%
  # select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 15) %>%
  filter(period==1965) %>%
  corpus(docid_field="speech_id",
         text_field="speech") %>%
  tokenize_word_stems(stopwords=stopwords) %>%
  tokens(remove_punct=FALSE, #CREATE TOKEN OBJECT
         split_tags=TRUE,
         split_elisions=TRUE,
         remove_symbols=TRUE,
         remove_numbers=TRUE,
         remove_separators=TRUE,
         padding=FALSE,
         xptr=TRUE,
         verbose=TRUE) %>%
  tokens_remove("\\p{P}", valuetype = "regex", #REMOVE PUNCT
                padding=TRUE, #REPLACE W/ EMPTY STRINGS
                verbose=TRUE) %>%
  tokens_ngrams(n=2) %>% #CREATE BIGRAMS
  dfm()

enviroLaborBigrams_1965_lda <- LDA(enviroLaborBigrams_1965_dtm, k = 9, control = list(seed = 1234))

enviroLaborBigrams_1965_topics <- tidy(enviroLaborBigrams_1965_lda, matrix = "beta")

enviroLaborBigrams_1965_top_terms <- enviroLaborBigrams_1965_topics %>%
  group_by(topic) %>%
  slice_max(beta, n = 10) %>% 
  ungroup() %>%
  arrange(topic, -beta)

graph_enviroLaborBigrams_1965_top_terms <- enviroLaborBigrams_1965_top_terms %>%
  mutate(term = reorder_within(term, beta, topic)) %>%
  ggplot(aes(beta, term, fill = factor(topic))) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~ topic, scales = "free") +
  scale_y_reordered() +
  theme_minimal()

ggsave("figures/enviroLabor_topics_15yr_1965.jpg")



##### 1980 #####
enviroLaborBigrams_1980_dtm <- enviroLaborSpeeches %>%
  filter(environment=="Yes" & labor=="Yes") %>%
  # select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 15) %>%
  filter(period==1980) %>%
  corpus(docid_field="speech_id",
         text_field="speech") %>%
  tokenize_word_stems(stopwords=stopwords) %>%
  tokens(remove_punct=FALSE, #CREATE TOKEN OBJECT
         split_tags=TRUE,
         split_elisions=TRUE,
         remove_symbols=TRUE,
         remove_numbers=TRUE,
         remove_separators=TRUE,
         padding=FALSE,
         xptr=TRUE,
         verbose=TRUE) %>%
  tokens_remove("\\p{P}", valuetype = "regex", #REMOVE PUNCT
                padding=TRUE, #REPLACE W/ EMPTY STRINGS
                verbose=TRUE) %>%
  tokens_ngrams(n=2) %>% #CREATE BIGRAMS
  dfm()

enviroLaborBigrams_1980_lda <- LDA(enviroLaborBigrams_1980_dtm, k = 9, control = list(seed = 1234))

enviroLaborBigrams_1980_topics <- tidy(enviroLaborBigrams_1980_lda, matrix = "beta")

enviroLaborBigrams_1980_top_terms <- enviroLaborBigrams_1980_topics %>%
  group_by(topic) %>%
  slice_max(beta, n = 10) %>% 
  ungroup() %>%
  arrange(topic, -beta)

graph_enviroLaborBigrams_1980_top_terms <- enviroLaborBigrams_1980_top_terms %>%
  mutate(term = reorder_within(term, beta, topic)) %>%
  ggplot(aes(beta, term, fill = factor(topic))) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~ topic, scales = "free") +
  scale_y_reordered() +
  theme_minimal()

ggsave("figures/enviroLabor_topics_15yr_1980.jpg")


##### 1995 #####
enviroLaborBigrams_1995_dtm <- enviroLaborSpeeches %>%
  filter(environment=="Yes" & labor=="Yes") %>%
  # select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 15) %>%
  filter(period==1995) %>%
  corpus(docid_field="speech_id",
         text_field="speech") %>%
  tokenize_word_stems(stopwords=stopwords) %>%
  tokens(remove_punct=FALSE, #CREATE TOKEN OBJECT
         split_tags=TRUE,
         split_elisions=TRUE,
         remove_symbols=TRUE,
         remove_numbers=TRUE,
         remove_separators=TRUE,
         padding=FALSE,
         xptr=TRUE,
         verbose=TRUE) %>%
  tokens_remove("\\p{P}", valuetype = "regex", #REMOVE PUNCT
                padding=TRUE, #REPLACE W/ EMPTY STRINGS
                verbose=TRUE) %>%
  tokens_ngrams(n=2) %>% #CREATE BIGRAMS
  dfm()

enviroLaborBigrams_1995_lda <- LDA(enviroLaborBigrams_1995_dtm, k = 9, control = list(seed = 1234))

enviroLaborBigrams_1995_topics <- tidy(enviroLaborBigrams_1995_lda, matrix = "beta")

enviroLaborBigrams_1995_top_terms <- enviroLaborBigrams_1995_topics %>%
  group_by(topic) %>%
  slice_max(beta, n = 10) %>% 
  ungroup() %>%
  arrange(topic, -beta)

graph_enviroLaborBigrams_1995_top_terms <- enviroLaborBigrams_1995_top_terms %>%
  mutate(term = reorder_within(term, beta, topic)) %>%
  ggplot(aes(beta, term, fill = factor(topic))) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~ topic, scales = "free") +
  scale_y_reordered() +
  theme_minimal()

ggsave("figures/enviroLabor_topics_15yr_1995.jpg")


##### 2010 #####
enviroLaborBigrams_2010_dtm <- enviroLaborSpeeches %>%
  filter(environment=="Yes" & labor=="Yes") %>%
  # select(speech_id,term,count,year) %>%
  mutate(period = as.numeric(year) - as.numeric(year) %% 15) %>%
  filter(period==2010) %>%
  corpus(docid_field="speech_id",
         text_field="speech") %>%
  tokenize_word_stems(stopwords=stopwords) %>%
  tokens(remove_punct=FALSE, #CREATE TOKEN OBJECT
         split_tags=TRUE,
         split_elisions=TRUE,
         remove_symbols=TRUE,
         remove_numbers=TRUE,
         remove_separators=TRUE,
         padding=FALSE,
         xptr=TRUE,
         verbose=TRUE) %>%
  tokens_remove("\\p{P}", valuetype = "regex", #REMOVE PUNCT
                padding=TRUE, #REPLACE W/ EMPTY STRINGS
                verbose=TRUE) %>%
  tokens_ngrams(n=2) %>% #CREATE BIGRAMS
  dfm()

enviroLaborBigrams_2010_lda <- LDA(enviroLaborBigrams_2010_dtm, k = 9, control = list(seed = 1234))

enviroLaborBigrams_2010_topics <- tidy(enviroLaborBigrams_2010_lda, matrix = "beta")

enviroLaborBigrams_2010_top_terms <- enviroLaborBigrams_2010_topics %>%
  group_by(topic) %>%
  slice_max(beta, n = 10) %>% 
  ungroup() %>%
  arrange(topic, -beta)

graph_enviroLaborBigrams_2010_top_terms <- enviroLaborBigrams_2010_top_terms %>%
  mutate(term = reorder_within(term, beta, topic)) %>%
  ggplot(aes(beta, term, fill = factor(topic))) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~ topic, scales = "free") +
  scale_y_reordered() +
  theme_minimal()

ggsave("figures/enviroLabor_topics_15yr_2010.jpg")

```









#### triples (since 1960)

working on it...
```{r extract triples, echo=FALSE}

enviroSentences <- enviroLaborSpeeches %>%
  filter(environment=="Yes") %>%
  unnest_sentences(output=sentence,
                   input=speech,
                   strip_punct=TRUE,
                   format="text",
                   to_lower=TRUE,
                   drop=TRUE)
# enviroTriples <- extract_triples(enviroLaborSpeeches$speech) #, combine_adj=TRUE, lemmatize=TRUE, add_aux=FALSE)
enviroTriples <- extract_adj_noun_pairs(enviroLaborSpeeches$speech,lemmatize=TRUE) #, combine_adj=TRUE, lemmatize=TRUE, add_aux=FALSE)


# enviroTriples <- enviroLaborSpeeches %>%
#   filter(environment=="Yes") %>%
#   sample_n(20) %>%
#   extract_triples(col=speech, lemmatize=TRUE)

enviroTriples <- extract_triples(enviroSentences$sentence) #, combine_adj=TRUE, lemmatize=TRUE, add_aux=FALSE)


enviroTriples_count <- enviroTriples %>%
  count(triple) %>%
  arrange(desc(n)) %>%

extract_adj_noun_pairs()
# extract_subj_verb_pairs()

```


```{r}


enviroLaborBigrams_separated <- enviroLaborBigrams %>%
  filter(year>=1965) %>%
  separate(term, c("word1", "word2"), sep = "_")




# count words co-occuring within sections

impWord_cors <- yelpImpossibleBurgerTokens2 %>%
  group_by(word) %>%
  filter(n() >= 10) %>%
  pairwise_cor(word, business_id, sort = TRUE)

set.seed(2016)

pdf("impBurgerCooccurenceNetwork.pdf")
impWord_cors %>%
  filter(correlation > .45) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = "lightblue", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE) +
  theme_void()
dev.off()









trump_corpus <- Corpus(VectorSource(as.vector(trumptweets$text)))

#DTM - turning it all into a matrix (for topic modeling)
trump_DTM <- DocumentTermMatrix(trump_corpus, control = list(wordLengths = c(2, Inf)))

inspect(trump_DTM[1:5,3:8])

#in tidytext
tidy_trump_DTM<-
  tidy_trump_tweets %>%
  count(created_at, word) %>%
  cast_dtm(created_at, word, n)


```

